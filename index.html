<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <!-- /// META TI√äU ƒê·ªÄ & M√î T·∫¢ /// -->
        <title>Loif Chan (htch9999) | Profile</title>
        <meta name="description" content="üå∑">
        <meta name="author" content="htch9999 - Loif.Ch">

        <link rel="canonical" href="https://htch9999.github.io/">

        <link rel="icon" href="https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg" type="image/jpeg">
        <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg">
        <!-- /// META OPEN GRAPH /// -->
        <meta property="og:title" content="HTCH - Profile">
        <meta property="og:description" content="Kh√°m ph√° profile HTCH: Playlist nh·∫°c MP3 v√† YouTube t·ª± ƒë·ªông, To-Do list h·∫πn gi·ªù v√† c√¥ng c·ª• t√¨m ki·∫øm, xem anime ti·ªán l·ª£i.">
        <meta property="og:type" content="profile">
        <meta property="og:url" content="https://htch9999.github.io/">
        <!-- !! Quan tr·ªçng: Thay b·∫±ng URL ch√≠nh th·ª©c c·ªßa b·∫°n !! -->
        <meta property="og:image" content="https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg">
        <meta property="og:image:alt" content="·∫¢nh ƒë·∫°i di·ªán c·ªßa HTCH">
        <meta property="og:locale" content="vi_VN">
        <meta property="profile:username" content="htch9999">
        <!-- /// META TWITTER CARD /// -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="HTCH - Profile">
        <meta name="twitter:description" content="K·∫øt n·ªëi HTCH! Nghe nh·∫°c MP3/YouTube, qu·∫£n l√Ω c√¥ng vi·ªác, t√¨m v√† xem anime y√™u th√≠ch ngay tr√™n profile ƒë·ªôc ƒë√°o n√†y.">
        <meta name="twitter:image" content="https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg">
        <meta name="twitter:site" content="@htch9999">
        <!-- Thay n·∫øu c√≥ -->
        <meta name="twitter:creator" content="@htch9999">
        <!-- Thay n·∫øu c√≥ -->
        <!-- /// GOOGLE FONTS /// -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
        <!-- /// IONICONS /// -->
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js" defer></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js" defer></script>
        <!-- /// ANIME.JS /// -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
        <style>
            /* === CSS RESET & BASE STYLES === */
            *, *::before, *::after {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                /* === DARK MODE PALETTE === */
                --color-bg-dark: #0d0d1a;
                --color-bg-secondary: #1a1a2e;
                --color-bg-tertiary: #16213e;
                
                /* Primary Colors - Neon Lime Green */
                --color-primary: #aeff62;
                --color-primary-rgb: 174, 255, 98;
                --color-primary-light: #c2ff88;
                --color-primary-glow: rgba(174, 255, 98, 0.3);
                
                /* Accent Colors */
                --color-secondary: #00ffff;
                --color-accent: #ff006e;
                --color-accent-secondary: #8338ec;
                
                /* Text Colors */
                --color-text-primary: #f5f5f7;
                --color-text-secondary: #a8a8b3;
                --color-text-tertiary: #7e7e8e;
                
                /* Glass Effect Variables */
                --glass-blur: 25px;
                --glass-opacity-primary: 0.15;
                --glass-opacity-secondary: 0.08;
                --glass-border-color: rgba(174, 255, 98, 0.25);
                
                /* Glitch Colors */
                --color-glitch-1: #00ffff;
                --color-glitch-2: #ff006e;
                
                /* Typography */
                --font-primary: 'Inter', sans-serif;
                --font-secondary: 'Orbitron', sans-serif;
                
                /* Grid & Layout */
                --grid-size: 30px;
                --grid-line-color: rgba(174, 255, 98, 0.06);
                --grid-line-width: 1px;
                
                /* Spacing Scale */
                --space-xxs: 0.25rem;
                --space-xs: 0.5rem;
                --space-sm: 0.85rem;
                --space-md: 1.25rem;
                --space-lg: 2rem;
                --space-xl: 2.5rem;
                
                /* Border Radius */
                --border-radius-sm: 6px;
                --border-radius-md: 12px;
                --border-radius-lg: 20px;
                --border-radius-xl: 28px;
                --border-radius-circle: 50%;
                
                /* Transitions */
                --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            html {
                font-size: 16px;
                scroll-behavior: smooth;
            }

            body {
                font-family: var(--font-primary);
                color: var(--color-text-primary);
                background-color: var(--color-bg-dark);
                /* Thay URL_HINH_CUA_BAN b·∫±ng link h√¨nh/GIF c·ªßa b·∫°n */
                background-image: url('https://raw.githubusercontent.com/htch9999/htch.github.io/main/assets/bg.jpeg');
                background-size: cover;
                background-position: center;
                background-attachment: scroll;
                background-repeat: no-repeat;
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: var(--space-sm);
                overflow-x: hidden;
                position: relative;
                line-height: 1.6;
            }

            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4" viewBox="0 0 4 4"><path fill="%23cccccc" fill-opacity="0.02" d="M0 0h2v2H0zM2 2h2v2H0z"></path></svg>');
                opacity: 0.6;
                pointer-events: none;
                z-index: -1;
                animation: scanlines 15s linear infinite;
            }

            @keyframes scanlines {
                0% {
                    background-position: 0 0;
                }

                100% {
                    background-position: 0 150px;
                }
            }

            /* === MAIN CONTAINER - COMPLETE GLASSMORPHISM REDESIGN === */
            #container {
                /* Multi-layer gradient background */
                background: linear-gradient(135deg, 
                    rgba(13, 13, 26, 0.6) 0%,
                    rgba(26, 26, 46, 0.4) 50%,
                    rgba(13, 13, 26, 0.5) 100%);
                
                /* Enhanced glass effect */
                backdrop-filter: blur(var(--glass-blur)) saturate(180%) brightness(0.95);
                -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(180%) brightness(0.95);
                
                /* Premium border with glow */
                border: 1px solid var(--glass-border-color);
                border-radius: var(--border-radius-xl);
                padding: var(--space-lg);
                
                /* Size & layout */
                width: 110%;
                max-width: 1600px;
                height: auto;
                margin: auto;
                text-align: center;
                
                /* Multi-layer shadow for depth */
                box-shadow: 
                    0 20px 60px rgba(0, 0, 0, 0.7),
                    0 0 60px rgba(174, 255, 98, 0.1),
                    inset 0 1px 2px rgba(255, 255, 255, 0.2),
                    inset 0 -1px 2px rgba(0, 0, 0, 0.3);
                
                /* Positioning & effects */
                position: relative;
                overflow: hidden;
                transform-style: preserve-3d;
                opacity: 0;
                transform: translateY(30px);
                display: flex;
                flex-direction: row;
                gap: 0;
                
                /* Smooth transitions */
                transition: all var(--transition-normal) ease;
            }

            /* Animated background glow effect */
            #container::before {
                content: '';
                position: absolute;
                inset: -1px;
                background: radial-gradient(circle at 30% 30%, 
                    rgba(174, 255, 98, 0.15) 0%,
                    transparent 50%);
                border-radius: var(--border-radius-xl);
                opacity: 0;
                animation: glowPulse 4s ease-in-out infinite;
                pointer-events: none;
                z-index: -1;
            }

            @keyframes glowPulse {
                0%, 100% { opacity: 0; }
                50% { opacity: 1; }
            }

            /* === COMPONENT ANIMATIONS === */
            @keyframes fadeInSlideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            @keyframes slideInLeft {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            @keyframes pulseGlow {
                0%, 100% {
                    box-shadow: 0 0 10px rgba(174, 255, 98, 0.3);
                }
                50% {
                    box-shadow: 0 0 20px rgba(174, 255, 98, 0.5);
                }
            }

            #container:hover {
                border-color: rgba(174, 255, 98, 0.4);
                box-shadow: 
                    0 25px 70px rgba(0, 0, 0, 0.8),
                    0 0 80px rgba(174, 255, 98, 0.15),
                    inset 0 1px 2px rgba(255, 255, 255, 0.25),
                    inset 0 -1px 2px rgba(0, 0, 0, 0.4);
            
                transform-style: preserve-3d;
                opacity: 0;
                transform: translateY(20px);
                display: flex;
                flex-direction: row;
                gap: 0;
            }

            .left-column, .right-column {
                display: flex;
                flex-direction: column;
                gap: var(--space-md);
                text-align: center;
            }

            .left-column {
                flex: 0 0 400px;
                padding-right: var(--space-lg);
                border-right: 1px solid rgba(174, 255, 98, 0.15);
                background: linear-gradient(180deg, 
                    rgba(174, 255, 98, 0.05) 0%, 
                    transparent 100%);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                transition: all var(--transition-normal) ease;
            }

            .left-column:hover {
                background: linear-gradient(180deg, 
                    rgba(174, 255, 98, 0.08) 0%, 
                    transparent 100%);
                border-color: rgba(174, 255, 98, 0.25);
            }

            .right-column {
                flex: 1;
                padding-left: var(--space-lg);
                background: linear-gradient(180deg, 
                    rgba(51, 136, 204, 0.03) 0%, 
                    transparent 100%);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                transition: all var(--transition-normal) ease;
            }

            .right-column:hover {
                background: linear-gradient(180deg, 
                    rgba(51, 136, 204, 0.06) 0%, 
                    transparent 100%);
            }

            /* === TABS STYLES - PREMIUM GLASSMORPHISM === */
            .tabs-nav {
                display: flex;
                gap: var(--space-xs);
                border-bottom: 2px solid rgba(174, 255, 98, 0.15);
                margin-bottom: var(--space-md);
                background: linear-gradient(90deg, 
                    rgba(174, 255, 98, 0.08) 0%, 
                    transparent 100%);
                padding: var(--space-sm) var(--space-md);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-radius: var(--border-radius-lg);
                transition: all var(--transition-normal) ease;
                animation: fadeInSlideUp 0.6s ease-out;
            }

            .tab-link {
                background: none;
                border: none;
                color: var(--color-text-secondary);
                font-family: var(--font-secondary);
                font-size: 0.95rem;
                font-weight: 500;
                padding: var(--space-xs) var(--space-md);
                cursor: pointer;
                transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
                border-bottom: 3px solid transparent;
                border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
                position: relative;
                top: 2px;
                letter-spacing: 0.5px;
                animation: fadeInSlideUp 0.5s ease-out backwards;
            }

            .tab-link:hover {
                color: var(--color-primary);
                background: rgba(174, 255, 98, 0.08);
                border-radius: var(--border-radius-sm);
                transform: translateY(-2px);
            }

            .tab-link.active {
                color: var(--color-primary);
                border-bottom-color: var(--color-primary);
                text-shadow: 0 0 15px rgba(174, 255, 98, 0.6);
                background: rgba(174, 255, 98, 0.12);
                box-shadow: 0 -2px 15px rgba(174, 255, 98, 0.15);
            }

            .tab-content {
                display: none;
                opacity: 0;
                animation: fadeOut 0.4s ease-out forwards;
            }

            .tab-content.active {
                display: block;
                opacity: 1;
                animation: fadeIn 0.4s ease-in forwards;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-10px); }
            }

            /* === PROFILE SECTION === */
            #profile {
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #profile-image-wrapper {
                position: relative;
                width: 100px;
                height: 100px;
                margin-bottom: var(--space-xs);
            }

            #profile-image-wrapper::before {
                content: '';
                position: absolute;
                inset: -4px;
                border-radius: var(--border-radius-circle);
                background: conic-gradient(from 90deg, transparent 0%, var(--color-secondary) 25%, var(--color-primary) 50%, var(--color-secondary) 75%, transparent 100%);
                filter: blur(12px);
                z-index: -1;
                animation: rotateGlow 5s linear infinite;
                opacity: 0.7;
            }

.profile-heart-badge {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 28px;
    height: 28px;
    z-index: 2;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.profile-heart-badge::before {
    content: '';
    position: absolute;
    inset: -4px;
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
    z-index: -1;
    opacity: 0.3;
    clip-path: polygon(
        50% 10%,
        61% 3%,
        73% 0%,
        84% 3%,
        92% 10%,
        97% 20%,
        99% 32%,
        97% 44%,
        91% 55%,
        83% 65%,
        73% 75%,
        61% 85%,
        50% 95%,
        39% 85%,
        27% 75%,
        17% 65%,
        9% 55%,
        3% 44%,
        1% 32%,
        3% 20%,
        8% 10%,
        16% 3%,
        27% 0%,
        39% 3%
    );
    filter: blur(8px);
}

.profile-heart-badge::after {
    content: '';
    position: absolute;
    inset: -1px;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.4) 0%, rgba(255, 165, 0, 0.3) 100%);
    border: 3.5px solid #FFD700;
    box-shadow: 
        0 0 15px rgba(255, 215, 0, 0.7),
        0 2px 10px rgba(0, 0, 0, 0.3),
        inset 0 1px 2px rgba(255, 255, 255, 0.4);
    z-index: -1;
    clip-path: polygon(
        50% 10%,
        61% 3%,
        73% 0%,
        84% 3%,
        92% 10%,
        97% 20%,
        99% 32%,
        97% 44%,
        91% 55%,
        83% 65%,
        73% 75%,
        61% 85%,
        50% 95%,
        39% 85%,
        27% 75%,
        17% 65%,
        9% 55%,
        3% 44%,
        1% 32%,
        3% 20%,
        8% 10%,
        16% 3%,
        27% 0%,
        39% 3%
    );
}

.profile-heart-badge img {
    width: 90%;
    height: 90%;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    animation: heartBeat 2.5s ease-in-out infinite;
    transition: all 0.3s ease;
}

.profile-heart-badge:hover {
    transform: scale(1.2) rotate(10deg);
}

.profile-heart-badge:hover::before {
    filter: blur(12px);
    opacity: 0.5;
}

.profile-heart-badge:hover::after {
    border-width: 3px;
    box-shadow: 
        0 0 30px rgba(255, 215, 0, 1),
        0 4px 15px rgba(0, 0, 0, 0.4),
        inset 0 1px 3px rgba(255, 255, 255, 0.6);
}

.profile-heart-badge:hover img {
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)) 
           drop-shadow(0 0 15px rgba(200, 150, 255, 0.6));
    animation: heartBeatFast 0.8s ease-in-out infinite;
}

@keyframes heartBeat {
    0%, 100% { transform: scale(1); }
    10%, 30% { transform: scale(1.08); }
    20%, 40% { transform: scale(1); }
}

@keyframes heartBeatFast {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
}

            @keyframes rotateGlow {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }

            #profile img#avatar {
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: var(--border-radius-circle);
                border: 2px solid var(--color-primary);
                padding: 2px;
                background-color: var(--color-bg-dark);
                transition: transform 40ms ease, box-shadow 40ms ease;
                cursor: pointer;
                position: relative;
                z-index: 1;
            }

            #profile img#avatar:hover {
                transform: scale(1.05) rotate(2deg);
                box-shadow: 0 0 15px var(--color-primary);
            }

            #profile p#username {
                font-weight: 500;
                font-size: 1.05rem;
                color: var(--color-text-primary);
                margin-top: var(--space-xxs);
                font-family: var(--font-secondary);
                letter-spacing: 1px;
                text-shadow: 0 0 4px var(--color-secondary), 1px 1px 1px rgba(0,0,0,0.5);
                margin-bottom: var(--space-xxs);
            }

            .glitch-text {
                position: relative;
                text-shadow: 0.05em 0 0 var(--color-glitch-1), -0.025em -0.05em 0 var(--color-glitch-2), 0.025em 0.05em 0 var(--color-glitch-1);
                animation: glitchAnim 0.5s infinite alternate;
            }

            @keyframes glitchAnim {
                0% {
                    text-shadow: .05em 0 0 var(--color-glitch-1),-.05em -.025em 0 var(--color-glitch-2),-.025em .05em 0 var(--color-glitch-1)
                }

                25% {
                    text-shadow: -0.05em -0.025em 0 var(--color-glitch-1),.025em .025em 0 var(--color-glitch-2),-0.05em -0.05em 0 var(--color-glitch-1);
                }

                50% {
                    text-shadow: .025em .05em 0 var(--color-glitch-1),.05em 0 0 var(--color-glitch-2),0 -.05em 0 var(--color-glitch-1)
                }

                75% {
                    text-shadow: -.05em 0 0 var(--color-glitch-1),-.025em -.025em 0 var(--color-glitch-2),-.025em -.05em 0 var(--color-glitch-1)
                }

                100% {
                    text-shadow: -.025em 0 0 var(--color-glitch-1),.025em -.025em 0 var(--color-glitch-2),.05em .05em 0 var(--color-glitch-1)
                }
            }

            /* === CLOCK STYLES === */
            #clock {
                font-family: var(--font-secondary);
                font-size: 0.85rem;
                color: var(--color-text-secondary);
                letter-spacing: 1.5px;
                opacity: 0;
                transform: translateY(10px);
                /* Animation */
                text-shadow: 0 0 3px rgba(var(--color-primary-rgb), 0.3);
                margin-bottom: 0;
            }

            /* === LOCATION & WEATHER STYLES === */
            #location-weather {
                font-family: var(--font-primary);
                font-size: 0.8rem;
                color: var(--color-text-secondary);
                margin-top: var(--space-xs);
                opacity: 0; /* For animation */
                transform: translateY(10px); /* For animation */
                text-shadow: 0 0 2px rgba(var(--color-primary-rgb), 0.2);
            }

            #location {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
            }

            #weather {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                font-size: 1.2rem;
                font-family: var(--font-secondary);
                margin-top: var(--space-xs);
                color: var(--color-text-primary);
            }

            #location ion-icon {
                font-size: 1.1em;
                color: var(--color-accent);
            }

            #weather ion-icon {
                font-size: 1.8em;
                color: var(--color-accent);
            }

            /* === INFO WIDGET SECTION === */
            #info-widget-section {
                margin-top: var(--space-sm);
                border-top: 1px solid rgba(var(--color-primary-rgb), 0.15);
                padding-top: var(--space-sm);
                opacity: 0;
                transform: translateY(10px);
                display: flex;
                flex-direction: column;
                gap: var(--space-xs);
            }

            .info-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: var(--space-xs);
            }

            .info-card {
                background: linear-gradient(145deg, 
                    rgba(174, 255, 98, 0.12) 0%,
                    rgba(51, 136, 204, 0.06) 50%,
                    rgba(174, 255, 98, 0.04) 100%);
                border: 1.5px solid rgba(174, 255, 98, 0.3);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
                backdrop-filter: blur(20px) saturate(150%);
                -webkit-backdrop-filter: blur(20px) saturate(150%);
                box-shadow: 
                    0 8px 24px rgba(0, 0, 0, 0.25),
                    0 0 25px rgba(174, 255, 98, 0.12),
                    inset 0 1px 1px rgba(255, 255, 255, 0.2);
                cursor: pointer;
                position: relative;
                overflow: hidden;
                animation: fadeInScale 0.6s ease-out backwards;
            }

            /* Compact info card - 2 rows layout */
            .info-card.compact-info {
                padding: var(--space-sm) var(--space-md);
                display: flex;
                flex-direction: column;
                gap: var(--space-xs);
                width: 120%;
                left: -10%;
            }

            .info-row {
                display: flex;
                align-items: center;
                justify-content: space-around;
                gap: var(--space-sm);
                width: 100%;
            }

            .info-item {
                display: flex;
                align-items: center;
                gap: var(--space-xs);
                flex: 1;
                text-align: center;
                justify-content: center;
                min-width: 0;
            }

            .info-icon {
                font-size: 1.4rem;
                color: var(--color-primary);
                flex-shrink: 0;
            }

            .info-value {
                font-size: 0.85rem;
                color: var(--color-text-primary);
                font-weight: 600;
                font-family: var(--font-primary);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .info-separator {
                width: 1.5px;
                height: 24px;
                background: linear-gradient(180deg, 
                    transparent 0%,
                    rgba(174, 255, 98, 0.3) 50%,
                    transparent 100%);
                flex-shrink: 0;
            }

            .info-row-separator {
                width: 100%;
                height: 1px;
                background: linear-gradient(90deg, 
                    transparent 0%,
                    rgba(174, 255, 98, 0.3) 50%,
                    transparent 100%);
            }

            .info-card::before {
                content: '';
                position: absolute;
                inset: 0;
                background: radial-gradient(circle at 100% 0%, 
                    rgba(51, 136, 204, 0.1) 0%,
                    transparent 70%);
                opacity: 0;
                transition: opacity var(--transition-fast) ease;
                pointer-events: none;
            }

.info-card:hover {
    background: linear-gradient(145deg, 
        rgba(174, 255, 98, 0.18) 0%,
        rgba(51, 136, 204, 0.1) 50%,
        rgba(174, 255, 98, 0.08) 100%);
    border-color: rgba(174, 255, 98, 0.45);
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        0 0 35px rgba(174, 255, 98, 0.15),
        inset 0 1px 1px rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
}

            .info-card:hover .info-icon {
                text-shadow: 0 0 10px rgba(174, 255, 98, 0.5);
            }

            .info-card:hover .info-value {
                color: var(--color-primary);
            }

            .info-card:hover::before {
                opacity: 1;
            }

            /* Old card styling - keeping for compatibility if needed */
            .card-icon {
                display: none;
            }

            .card-content {
                display: none;
            }

            .card-label {
                display: none;
            }

            .card-value {
                display: none;
            }

            /* Card-specific styling - deprecated */
            .location-card .card-icon {
                display: none;
            }

            .weather-card .card-icon {
                color: var(--color-accent);
            }

            .date-card .card-icon {
                color: var(--color-primary);
            }

            /* Light mode adjustments */
            body.light-mode .info-card {
                background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1) 0%, rgba(var(--color-primary-rgb), 0.05) 100%);
                border-color: rgba(var(--color-primary-rgb), 0.2);
            }

            body.light-mode .info-card:hover {
                background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.15) 0%, rgba(var(--color-primary-rgb), 0.08) 100%);
                border-color: rgba(var(--color-primary-rgb), 0.3);
            }

            body.light-mode .card-icon {
                background-color: rgba(var(--color-primary-rgb), 0.12);
            }

            body.light-mode .card-label {
                color: var(--color-text-secondary);
            }

            /* === TO-DO LIST STYLES - PREMIUM GLASS === */
            #todo-section {
                border-top: 1px solid rgba(174, 255, 98, 0.2);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                opacity: 0;
                transform: translateY(20px);
                background: linear-gradient(180deg, 
                    rgba(174, 255, 98, 0.08) 0%,
                    rgba(51, 136, 204, 0.04) 100%);
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
                transition: all var(--transition-normal) ease;
            }

            #todo-section:hover {
                background: linear-gradient(180deg, 
                    rgba(174, 255, 98, 0.12) 0%,
                    rgba(51, 136, 204, 0.06) 100%);
                border-color: rgba(174, 255, 98, 0.3);
            }

            .sci-fi-heading {
                font-family: var(--font-secondary);
                font-size: 1rem;
                color: var(--color-primary);
                text-align: center;
                margin-bottom: var(--space-xs);
                letter-spacing: 0.5px;
                text-shadow: 0 0 4px rgba(var(--color-primary-rgb), 0.4);
            }

            #todo-form {
                display: flex;
                flex-direction: column;
                gap: var(--space-xs);
                margin-bottom: var(--space-sm);
            }

            #todo-form .todo-input-group {
                display: flex;
                flex-wrap: wrap;
                gap: var(--space-xs);
            }

            #todo-form input[type="text"], #todo-form input[type="time"] {
                flex-grow: 1;
                padding: var(--space-sm) var(--space-md);
                background: rgba(174, 255, 98, 0.08);
                border: 1.5px solid rgba(174, 255, 98, 0.25);
                border-radius: var(--border-radius-md);
                color: var(--color-text-primary);
                font-family: var(--font-primary);
                font-size: 0.9rem;
                min-width: 100px;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                transition: all var(--transition-fast) ease;
            }

            #todo-form input[type="text"]:focus, #todo-form input[type="time"]:focus {
                background: rgba(174, 255, 98, 0.12);
                border-color: rgba(174, 255, 98, 0.45);
                box-shadow: 0 0 20px rgba(174, 255, 98, 0.25),
                            inset 0 0 4px rgba(174, 255, 98, 0.1);
                outline: none;
            }

            #todo-form input::placeholder {
                color: var(--color-text-tertiary);
                opacity: 0.7;
            }

            #todo-form input[type="time"] {
                flex-basis: 100px;
                flex-grow: 0;
                appearance: none;
                -webkit-appearance: none;
            }

            #todo-form input[type="time"]::-webkit-calendar-picker-indicator {
                display: none;
            }

            #todo-form input[type="time"]::-webkit-datetime-edit-ampm-field {
                color: var(--color-accent);
            }

            #todo-form input[type="time"]::-webkit-datetime-edit-hour-field, #todo-form input[type="time"]::-webkit-datetime-edit-minute-field {
                color: var(--color-text-primary);
            }

            #todo-form input::placeholder {
                color: var(--color-text-secondary);
                opacity: 0.7;
            }

            #add-todo-btn, #request-permission-btn {
                padding: var(--space-sm) var(--space-md);
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.25) 0%,
                    rgba(51, 136, 204, 0.15) 100%);
                border: 1.5px solid var(--color-primary);
                color: var(--color-primary);
                font-family: var(--font-secondary);
                font-weight: 600;
                font-size: 0.95rem;
                border-radius: var(--border-radius-md);
                cursor: pointer;
                transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: var(--space-xs);
                height: 42px;
                min-width: 100px;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                box-shadow: 
                    0 6px 15px rgba(0, 0, 0, 0.25),
                    0 0 20px rgba(174, 255, 98, 0.1),
                    inset 0 1px 1px rgba(255, 255, 255, 0.2);
                letter-spacing: 0.5px;
                animation: fadeInScale 0.5s ease-out backwards;
            }

            #add-todo-btn:hover, #request-permission-btn:hover {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.35) 0%,
                    rgba(51, 136, 204, 0.25) 100%);
                color: #000;
                border-color: var(--color-primary-light);
                box-shadow: 
                    0 10px 30px rgba(174, 255, 98, 0.3),
                    0 0 40px rgba(174, 255, 98, 0.2),
                    inset 0 1px 1px rgba(255, 255, 255, 0.3);
                transform: translateY(-3px);
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                /* Lo·∫°i b·ªè d√≤ng animation: pulseGlow 1.5s ease-in-out; */
            }

            #add-todo-btn:active {
                transform: translateY(-1px);
            }

            #request-permission-btn {
                display: none;
                margin-top: var(--space-xs);
            }

            #todo-list {
                list-style: none;
                padding: 0;
                margin: 0;
                max-height: 160px;
                overflow-y: auto;
                scrollbar-width: thin;
                scrollbar-color: var(--color-primary) rgba(var(--color-primary-rgb), 0.1);
            }

            #todo-list::-webkit-scrollbar {
                width: 5px;
            }

            #todo-list::-webkit-scrollbar-track {
                background: rgba(var(--color-primary-rgb), 0.08);
                border-radius: 3px;
            }

            #todo-list::-webkit-scrollbar-thumb {
                background-color: var(--color-primary);
                border-radius: 3px;
                border: 1px solid rgba(var(--color-primary-rgb), 0.2);
            }

            #todo-list li {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.12) 0%,
                    rgba(51, 136, 204, 0.08) 100%);
                border-left: 4px solid var(--color-primary);
                border: 1px solid rgba(174, 255, 98, 0.2);
                border-left: 4px solid var(--color-primary);
                padding: var(--space-sm) var(--space-md);
                margin-bottom: var(--space-xs);
                border-radius: var(--border-radius-md);
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: var(--space-md);
                transition: all var(--transition-normal) cubic-bezier(0.34, 1.56, 0.64, 1);
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.15),
                    inset 0 1px 1px rgba(255, 255, 255, 0.1);
            }

            #todo-list li:hover {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.18) 0%,
                    rgba(51, 136, 204, 0.12) 100%);
                border-color: rgba(174, 255, 98, 0.35);
                border-left-color: var(--color-primary);
                box-shadow: 
                    0 6px 20px rgba(174, 255, 98, 0.1),
                    inset 0 1px 1px rgba(255, 255, 255, 0.15);
                transform: translateX(4px);
            }

            #todo-list li.completed {
                border-left-color: var(--color-text-secondary);
                opacity: 0.6;
            }

            #todo-list li.completed .todo-text {
                text-decoration: line-through;
                color: var(--color-text-secondary);
            }

            #todo-list .todo-content {
                display: flex;
                flex-direction: column;
                flex-grow: 1;
                overflow: hidden;
                word-break: break-word;
            }

            #todo-list .todo-text {
                color: var(--color-text-primary);
                font-size: 0.9rem;
            }

            #todo-list .todo-time-info {
                font-size: 0.7rem;
                color: var(--color-text-secondary);
                margin-top: 2px;
                display: flex;
                align-items: center;
                gap: 4px;
                flex-wrap: wrap;
            }

            #todo-list .todo-time-info ion-icon {
                font-size: 0.85em;
            }

            #todo-list .todo-time-info ion-icon[name="alarm-outline"] {
                color: var(--color-accent);
            }

            #todo-list .todo-time-info ion-icon[name="checkmark-done-outline"] {
                color: var(--color-primary);
            }

            #todo-list .todo-actions {
                display: flex;
                gap: var(--space-xxs);
                flex-shrink: 0;
            }

            #todo-list .todo-actions button {
                background: none;
                border: none;
                color: var(--color-text-secondary);
                font-size: 1.2rem;
                cursor: pointer;
                padding: 4px;
                border-radius: 50%;
                transition: color var(--transition-speed-fast), background-color var(--transition-speed-fast);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            #todo-list .todo-actions button.delete-btn:hover {
                color: #ff4d4d;
                background-color: rgba(255, 77, 77, 0.1);
            }

            #todo-list .todo-actions button.complete-btn:hover {
                color: #4caf50;
                background-color: rgba(76, 175, 80, 0.1);
            }

            #todo-list li.completed .todo-actions button.complete-btn {
                color: #4caf50;
            }

            /* === AUDIO PLAYER - PREMIUM GLASS EFFECT === */
            #audio-player {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.12) 0%,
                    rgba(51, 136, 204, 0.06) 50%,
                    rgba(174, 255, 98, 0.05) 100%);
                border: 1.5px solid rgba(174, 255, 98, 0.3);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                opacity: 0;
                transform: translateY(20px);
                backdrop-filter: blur(var(--glass-blur)) saturate(150%);
                -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(150%);
                box-shadow: 
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 0 30px rgba(174, 255, 98, 0.1),
                    inset 0 1px 2px rgba(255, 255, 255, 0.15);
                display: flex;
                flex-direction: column;
                gap: var(--space-md);
                position: relative;
                transition: all var(--transition-normal) ease;
            }

            #audio-player:hover {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.15) 0%,
                    rgba(51, 136, 204, 0.08) 50%,
                    rgba(174, 255, 98, 0.08) 100%);
                border-color: rgba(174, 255, 98, 0.45);
                box-shadow: 
                    0 12px 48px rgba(0, 0, 0, 0.4),
                    0 0 50px rgba(174, 255, 98, 0.15),
                    inset 0 1px 2px rgba(255, 255, 255, 0.2);
                transform: translateY(-2px);
            }

            #audio-player .track-info {
                width: 100%;
                text-align: left;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                gap: var(--space-xs);
            }

            #audio-player #track-title {
                display: block;
                font-size: 0.95rem;
                color: var(--color-text-primary);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-family: var(--font-secondary);
                letter-spacing: 0.5px;
                padding: 0 var(--space-xs);
                min-height: 1.2em;
                line-height: 1.3;
            }

            #audio-player #track-title.is-youtube::before {
                content: '';
                display: inline-block;
                width: 14px;
                height: 10px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 11.2" fill="%23FF0000"><path d="M15.7.9A2 2 0 0014.1 0H1.9A2 2 0 00.3.9 22.6 22.6 0 000 5.6a22.6 22.6 0 00.3 4.7 2 2 0 001.6.9h12.2a2 2 0 001.6-.9 22.6 22.6 0 00.3-4.7 22.6 22.6 0 00-.3-4.7zM6.4 8V3.2l4.6 2.4-4.6 2.4z"/></svg>');
                background-repeat: no-repeat;
                background-size: contain;
                margin-right: 5px;
                vertical-align: baseline;
            }

            #audio-player .progress-container {
                width: 100%;
                height: 8px;
                background-color: rgba(0, 0, 0, 0.3);
                border-radius: var(--border-radius-sm);
                cursor: pointer;
                overflow: hidden;
                position: relative;
                border: 1px solid rgba(var(--color-primary-rgb), 0.1);
            }

            #audio-player #progress-bar {
                width: 0%;
                height: 100%;
                background-color: var(--color-primary);
                border-radius: var(--border-radius-sm);
                transition: width 0.1s linear;
                box-shadow: 0 0 8px 1px var(--color-primary);
            }

            #audio-player .controls {
                width: 100%;
                display: flex;
                justify-content: center;
                /* Centered controls */
                align-items: center;
                gap: var(--space-md);
                padding: 0 var(--space-xs);
            }

            #audio-player .controls .main-controls {
                display: flex;
                align-items: center;
                gap: var(--space-md);
            }

            #audio-player .controls button {
                background: none;
                border: none;
                color: var(--color-text-secondary);
                font-size: 1.6rem;
                cursor: pointer;
                padding: var(--space-xs);
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
                line-height: 1;
                border-radius: var(--border-radius-circle);
            }

            #audio-player .controls button:hover, #audio-player .controls button:focus {
                color: var(--color-secondary);
                transform: scale(1.1);
                outline: none;
                background-color: rgba(var(--color-primary-rgb), 0.1);
            }

            #audio-player .controls button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
                background-color: transparent;
            }

            #audio-player .controls button ion-icon {
                display: block;
            }

            #audio-player button#play-pause-btn {
                font-size: 2.4rem;
                color: var(--color-secondary);
            }

            #audio-player button#play-pause-btn:hover, #audio-player button#play-pause-btn:focus {
                color: var(--color-primary);
                background-color: rgba(var(--color-primary-rgb), 0.15);
            }

            /* === YouTube Player Container (Hidden) === */
            #youtube-player-container {
                position: absolute;
                /* Place it far off-screen */
                top: -9999px;
                left: -9999px;
                width: 1px;
                /* Minimal size */
                height: 1px;
                opacity: 0;
                /* Completely invisible */
                pointer-events: none;
                /* No interaction */
                /* Overflow hidden to ensure nothing bleeds out */
                overflow: hidden;
            }

            /* === ANIME SEARCH SECTION STYLES === */
            #anime-search-section {
                border-top: 1px solid rgba(var(--color-primary-rgb), 0.15);
                padding-top: var(--space-sm);
                margin-top: var(--space-sm);
                opacity: 0;
                transform: translateY(20px);
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
            }

            #search-wrapper {
                display: flex;
                gap: var(--space-sm);
                position: relative;
            }

            #anime-search-input {
                flex-grow: 1;
                padding: var(--space-sm) var(--space-md);
                padding-right: 45px;
                background: rgba(174, 255, 98, 0.1);
                border: 1.5px solid rgba(174, 255, 98, 0.3);
                border-radius: var(--border-radius-md);
                color: var(--color-text-primary);
                font-family: var(--font-primary);
                font-size: 0.95rem;
                transition: all var(--transition-fast) ease;
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
                animation: fadeInSlideUp 0.5s ease-out;
            }

            #anime-search-input:focus {
                outline: none;
                border-color: var(--color-primary);
                background: rgba(174, 255, 98, 0.15);
                box-shadow: 0 0 25px rgba(174, 255, 98, 0.35),
                            inset 0 0 4px rgba(174, 255, 98, 0.1);
                animation: pulseGlow 1.5s ease-in-out;
            }

            #anime-search-input::placeholder {
                color: var(--color-text-tertiary);
                opacity: 0.6;
            }

            #anime-search-input:disabled {
                cursor: not-allowed;
                opacity: 0.6;
            }

            #anime-search-input::-webkit-search-cancel-button, #anime-search-input::-webkit-search-decoration {
                -webkit-appearance: none;
                appearance: none;
            }

            #search-button {
                position: absolute;
                right: 2px;
                top: 2px;
                bottom: 2px;
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.2) 0%,
                    rgba(51, 136, 204, 0.1) 100%);
                border: 1px solid rgba(174, 255, 98, 0.25);
                color: var(--color-text-secondary);
                font-size: 1.5rem;
                cursor: pointer;
                padding: 0 var(--space-md);
                border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
                transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                box-shadow: inset -1px 0 1px rgba(255, 255, 255, 0.1);
                animation: slideInRight 0.4s ease-out;
            }

            #search-button:hover, #search-button:focus {
                color: var(--color-primary);
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.3) 0%,
                    rgba(51, 136, 204, 0.2) 100%);
                border-color: var(--color-primary);
                box-shadow: inset -1px 0 1px rgba(255, 255, 255, 0.15),
                            0 0 15px rgba(174, 255, 98, 0.2);
                /* Lo·∫°i b·ªè d√≤ng animation */
            }

            #search-button:disabled {
                cursor: not-allowed;
                opacity: 0.5;
                color: var(--color-text-secondary) !important;
            }

            #search-button:not(:disabled):hover {
                color: var(--color-primary);
            }

            #anime-results-container, #anime-episode-list-container {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.1) 0%,
                    rgba(51, 136, 204, 0.06) 100%);
                border: 1.5px solid rgba(174, 255, 98, 0.25);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                min-height: 60px;
                max-height: 280px;
                overflow-y: auto;
                scrollbar-width: thin;
                scrollbar-color: var(--color-primary) rgba(174, 255, 98, 0.2);
                transition: all var(--transition-normal) ease;
                backdrop-filter: blur(18px);
                -webkit-backdrop-filter: blur(18px);
                box-shadow: 
                    0 6px 20px rgba(0, 0, 0, 0.2),
                    inset 0 1px 1px rgba(255, 255, 255, 0.1);
                animation: fadeInScale 0.5s ease-out backwards;
            }

            #anime-results-container:hover, #anime-episode-list-container:hover {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.15) 0%,
                    rgba(51, 136, 204, 0.08) 100%);
                border-color: rgba(174, 255, 98, 0.35);
            }

            #anime-results-container::-webkit-scrollbar, #anime-episode-list-container::-webkit-scrollbar {
                width: 5px;
            }

            #anime-results-container::-webkit-scrollbar-track, #anime-episode-list-container::-webkit-scrollbar-track {
                background: rgba(var(--color-primary-rgb), 0.08);
                border-radius: 3px;
            }

            #anime-results-container::-webkit-scrollbar-thumb, #anime-episode-list-container::-webkit-scrollbar-thumb {
                background-color: var(--color-primary);
                border-radius: 3px;
                border: 1px solid rgba(var(--color-primary-rgb), 0.2);
            }

            #anime-episode-list-container {
                display: none;
                flex-direction: column;
                gap: var(--space-xs);
            }

            #episode-list-heading {
                margin-bottom: var(--space-xs);
                padding-bottom: var(--space-xs);
                border-bottom: 1px dashed rgba(var(--color-primary-rgb), 0.2);
                text-align: left;
            }

            #anime-episode-list {
                list-style: none;
                padding: 0;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: var(--space-xs);
            }

            .search-result-item, .episode-item {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.12) 0%,
                    rgba(51, 136, 204, 0.08) 100%);
                border-left: 4px solid var(--color-secondary);
                border: 1px solid rgba(174, 255, 98, 0.25);
                border-left: 4px solid var(--color-secondary);
                padding: var(--space-sm) var(--space-md);
                border-radius: var(--border-radius-md);
                cursor: pointer;
                transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
                font-size: 0.95rem;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
                text-align: left;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .search-result-item:hover, .episode-item:not([style*="cursor: not-allowed"]):hover, .search-result-item:focus, .episode-item:not([style*="cursor: not-allowed"]):focus {
                background: linear-gradient(135deg, 
                    rgba(174, 255, 98, 0.2) 0%,
                    rgba(51, 136, 204, 0.15) 100%);
                border-left-color: var(--color-primary);
                border-color: rgba(174, 255, 98, 0.4);
                transform: translateX(6px);
                outline: none;
                box-shadow: 
                    0 4px 16px rgba(174, 255, 98, 0.15),
                    inset 0 1px 1px rgba(255, 255, 255, 0.1);
            }
            

            .placeholder-text {
                color: var(--color-text-secondary);
                text-align: center;
                padding: var(--space-sm);
                font-style: italic;
                font-size: 0.9rem;
            }

            .placeholder-text.error {
                color: var(--color-accent);
                font-style: normal;
            }

            #back-to-search-btn {
                padding: var(--space-xs) var(--space-sm);
                background-color: rgba(var(--color-primary-rgb), 0.1);
                border: 1px solid rgba(var(--color-primary-rgb), 0.5);
                color: var(--color-primary);
                font-family: var(--font-secondary);
                font-weight: 500;
                font-size: 0.85rem;
                border-radius: var(--border-radius-sm);
                cursor: pointer;
                transition: all var(--transition-speed-fast) ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: var(--space-xxs);
                align-self: flex-start;
                margin-top: var(--space-sm);
            }

            #back-to-search-btn ion-icon {
                font-size: 1.1em;
            }

            #back-to-search-btn:hover, #back-to-search-btn:focus {
                background-color: var(--color-primary);
                color: var(--color-bg-dark);
                box-shadow: 0 0 8px rgba(var(--color-primary-rgb), 0.4);
                outline: none;
            }

            /* === IFRAME PLAYER CONTAINER (Anime Viewer) === */
            #anime-player-container {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.9);
                width: 90%;
                max-width: 800px;
                background-color: rgba(10, 10, 10, 0.85);
                backdrop-filter: blur(15px) saturate(190%);
                -webkit-backdrop-filter: blur(15px) saturate(190%);
                border: 1px solid rgba(var(--color-primary-rgb), 0.3);
                border-radius: var(--border-radius-lg);
                padding: var(--space-md);
                z-index: 1000;
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
                opacity: 0;
                transition: opacity 0.3s ease, transform 0.3s ease;
                will-change: opacity, transform;
                visibility: hidden;
            }

            #anime-player-container.visible {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
                visibility: visible;
            }

            #player-anime-title {
                font-family: var(--font-secondary);
                color: var(--color-primary);
                text-align: center;
                font-size: 1rem;
                margin: 0;
                padding-bottom: var(--space-xs);
                border-bottom: 1px solid rgba(var(--color-primary-rgb), 0.2);
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }

            .iframe-wrapper {
                position: relative;
                width: 100%;
                padding-bottom: 56.25%;
                height: 0;
                background-color: #000;
                border-radius: var(--border-radius-sm);
                overflow: hidden;
                border: 1px solid rgba(var(--color-primary-rgb), 0.1);
            }

            #anime-iframe {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: none;
                background-color: #000;
            }

            #close-player-btn {
                position: absolute;
                top: var(--space-xs);
                right: var(--space-xs);
                background: none;
                border: none;
                color: var(--color-text-secondary);
                font-size: 1.8rem;
                cursor: pointer;
                padding: 2px;
                line-height: 1;
                transition: color var(--transition-speed-fast), transform var(--transition-speed-fast);
                border-radius: 50%;
                z-index: 10;
            }

            #close-player-btn:hover, #close-player-btn:focus {
                color: var(--color-primary);
                transform: rotate(90deg);
                outline: none;
            }

            /* Overlay when player is open */
            body.player-open::after {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(3px);
                -webkit-backdrop-filter: blur(3px);
                z-index: 999;
                opacity: 0;
                transition: opacity 0.3s ease;
                pointer-events: all;
                visibility: hidden;
            }

            body.player-open::after {
                opacity: 1;
                visibility: visible;
            }

            /* === LINKS LIST === */
            #links {
                border-top: 1px solid rgba(var(--color-primary-rgb), 0.15);
                padding-top: var(--space-sm);
                margin-top: var(--space-sm);
            }

            #links ul {
                list-style: none;
                padding: 0;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
            }

            #links li {
                opacity: 0;
                transform: translateX(-20px);
                /* Animation */
            }

            #links a {
                display: block;
                padding: var(--space-sm) var(--space-md);
                text-decoration: none;
                color: var(--color-text-primary);
                background-color: rgba(var(--color-primary-rgb), 0.1);
                border: 1px solid rgba(var(--color-primary-rgb), 0.5);
                border-radius: var(--border-radius-sm);
                font-weight: 500;
                transition: all var(--transition-speed-fast) ease-out;
                position: relative;
                overflow: hidden;
                z-index: 1;
                will-change: transform, background-color, box-shadow;
                text-align: center;
            }

            #links a::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(var(--color-primary-rgb), 0.4), transparent);
                transition: left var(--transition-speed-normal) ease-out;
                z-index: -1;
            }

            #links a:hover, #links a:focus {
                background-color: rgba(var(--color-primary-rgb), 0.25);
                border-color: var(--color-primary);
                color: #fff;
                transform: scale(1.03);
                box-shadow: 0 0 15px rgba(var(--color-primary-rgb), 0.4);
                outline: none;
            }

            #links a:hover::before, #links a:focus::before {
                left: 100%;
            }

            #links a:active {
                transform: scale(0.98);
                background-color: rgba(var(--color-primary-rgb), 0.3);
            }

            /* === SOCIAL LINKS === */
            #social-links {
                display: flex;
                justify-content: center;
                gap: var(--space-md);
                padding-top: var(--space-sm);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                opacity: 0;
                transform: translateY(20px);
                /* Animation */
            }

            #social-links a {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                color: var(--color-text-secondary);
                font-size: 1.6rem;
                width: 40px;
                height: 40px;
                border-radius: var(--border-radius-circle);
                text-decoration: none;
                transition: all var(--transition-speed-fast) ease;
                will-change: transform, color, background-color;
            }

            #social-links a:hover, #social-links a:focus {
                color: var(--color-primary);
                transform: translateY(-3px) scale(1.1);
                outline: none;
                background-color: rgba(var(--color-primary-rgb), 0.1);
            }

            #social-links ion-icon {
                display: block;
            }

            /* === FOOTER === */
            footer {
                margin-top: var(--space-xs);
                font-size: 0.8rem;
                color: var(--color-text-secondary);
                opacity: 0;
                transform: translateY(20px);
                /* Animation */
                text-align: center;
            }

            footer a {
                color: var(--color-accent);
                text-decoration: none;
                font-weight: 500;
                transition: color var(--transition-speed-fast) ease, text-shadow var(--transition-speed-fast) ease;
            }

            footer a:hover, footer a:focus {
                color: var(--color-secondary);
                text-shadow: 0 0 5px var(--color-secondary);
                outline: none;
            }

            /* === RESPONSIVENESS === */
            @media (min-width: 769px) {
                #todo-list {
                    max-height: 350px;
                }
                #anime-results-container, #anime-episode-list-container {
                    max-height: 350px;
                }
            }

            @media (max-width: 900px) {
                .info-item {
                    flex: 0 1 auto;
                }

                .info-value {
                    font-size: 0.8rem;
                }

                .info-icon {
                    font-size: 1.2rem;
                }

                .info-separator {
                    height: 20px;
                }
            }

            @media (max-width: 600px) {
                .info-row {
                    gap: var(--space-xs);
                }

                .info-item {
                    gap: 0.25rem;
                }

                .info-icon {
                    font-size: 1rem;
                }

                .info-value {
                    font-size: 0.7rem;
                }

                .info-separator {
                    height: 16px;
                    width: 1px;
                }

                .info-card.compact-info {
                    padding: var(--space-xs) var(--space-sm);
                }
            }

            @media (min-width: 500px) {
                #todo-form {
                    flex-direction: row;
                    align-items: center;
                }

                #todo-form input[type="text"] {
                    max-width: none;
                }

                #todo-form input[type="time"] {
                    flex-basis: 100px;
                }

                #add-todo-btn {
                    align-self: center;
                }
            }

            @media (max-width: 768px) {
                #container {
                    flex-direction: column;
                }
                .left-column {
                    border-right: none;
                    padding-right: 0;
                    border-bottom: 1px solid rgba(var(--color-primary-rgb), 0.15);
                    padding-bottom: var(--space-md);
                    margin-bottom: var(--space-md);
                }
                .right-column {
                    padding-left: 0;
                }

                :root {
                    --space-lg: 1.8rem;
                    --space-md: 1.1rem;
                    --space-sm: 0.75rem;
                }

                #container {
                    padding: var(--space-md);
                    margin: var(--space-sm);
                    gap: var(--space-sm);
                }

                #profile-image-wrapper {
                    width: 90px;
                    height: 90px;
                }

                #clock {
                    font-size: 0.8rem;
                }

                #audio-player {
                    padding: var(--space-xs);
                }

                #audio-player #track-title {
                    font-size: 0.9rem;
                }

                #audio-player .controls {
                    gap: var(--space-sm);
                }

                #audio-player .controls button {
                    font-size: 1.5rem;
                }

                #audio-player button#play-pause-btn {
                    font-size: 2.2rem;
                }

                #social-links {
                    gap: var(--space-sm);
                }

                #social-links a {
                    font-size: 1.5rem;
                    width: 38px;
                    height: 38px;
                }

                #anime-results-container, #anime-episode-list-container {
                    max-height: 200px;
                }

                /* Custom footer placement for mobile */
                #container > footer {
                    order: 3; /* places it after left-column (1) and right-column (2) */
                    margin-top: var(--space-md);
                }
            }

            @media (max-width: 420px) {
                :root {
                    --space-md: 1rem;
                    --space-sm: 0.65rem;
                }

                #profile-image-wrapper {
                    width: 80px;
                    height: 80px;
                }

                #clock {
                    letter-spacing: 1px;
                }

                #audio-player #track-title {
                    font-size: 0.85rem;
                }

                #audio-player .controls {
                    gap: var(--space-xs);
                }

                #audio-player .controls button {
                    font-size: 1.4rem;
                    padding: calc(var(--space-xs) / 2);
                }

                #audio-player button#play-pause-btn {
                    font-size: 2rem;
                }

                #social-links {
                    gap: var(--space-xs);
                }

                #social-links a {
                    font-size: 1.4rem;
                    width: 34px;
                    height: 34px;
                }

                #links a {
                    padding: var(--space-sm);
                }

                #todo-list li {
                    flex-direction: column;
                    align-items: flex-start;
                }

                #todo-list .todo-actions {
                    margin-top: var(--space-xs);
                    align-self: flex-end;
                }

                #todo-form .todo-input-group {
                    flex-direction: column;
                }

                #todo-form input[type="time"] {
                    flex-basis: auto;
                    width: 100%;
                }

                #add-todo-btn {
                    width: 100%;
                    margin-top: var(--space-xs);
                }

                #anime-results-container, #anime-episode-list-container {
                    max-height: 180px;
                }

                .search-result-item, .episode-item {
                    font-size: 0.85rem;
                }
            }

            /* === UTILITY CLASSES === */
            .visually-hidden {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }
            /* === POMODORO TIMER STYLES - PREMIUM GLASS === */
#pomodoro-section {
    border-top: 1.5px solid rgba(174, 255, 98, 0.2);
    opacity: 1 !important;
    transform: translateY(0) !important;
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    align-items: center;
    background: linear-gradient(180deg, 
        rgba(174, 255, 98, 0.08) 0%,
        rgba(51, 136, 204, 0.04) 100%);
    padding: var(--space-lg);
    border-radius: var(--border-radius-lg);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.pomodoro-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-md);
    width: 100%;
    background: linear-gradient(135deg, 
        rgba(174, 255, 98, 0.15) 0%,
        rgba(51, 136, 204, 0.08) 100%);
    border: 1.5px solid rgba(174, 255, 98, 0.3);
    border-radius: var(--border-radius-lg);
    padding: var(--space-lg);
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.2),
        0 0 30px rgba(174, 255, 98, 0.1),
        inset 0 1px 1px rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px) saturate(150%);
    -webkit-backdrop-filter: blur(20px) saturate(150%);
    transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
}

.pomodoro-display:hover {
    background: linear-gradient(135deg, 
        rgba(174, 255, 98, 0.2) 0%,
        rgba(51, 136, 204, 0.12) 100%);
    border-color: rgba(174, 255, 98, 0.4);
    box-shadow: 
        0 12px 32px rgba(0, 0, 0, 0.25),
        0 0 40px rgba(174, 255, 98, 0.15),
        inset 0 1px 1px rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.timer-mode {
    font-family: var(--font-secondary);
    font-size: 1.1rem;
    color: var(--color-primary);
    letter-spacing: 1.5px;
    text-shadow: 0 0 10px rgba(174, 255, 98, 0.6);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--border-radius-md);
    background: rgba(174, 255, 98, 0.12);
    border: 1px solid rgba(174, 255, 98, 0.3);
    transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 120px;
    text-align: center;
    font-weight: 600;
}

.timer-mode:hover {
    background: rgba(174, 255, 98, 0.2);
    transform: scale(1.05);
}

.timer-value {
    font-family: var(--font-secondary);
    font-size: 4rem;
    font-weight: 800;
    color: var(--color-text-primary);
    text-shadow: 0 0 20px rgba(174, 255, 98, 0.8);
    letter-spacing: 3px;
    margin: 0;
    transition: all var(--transition-normal) ease;
}

.progress-bar-container {
    width: 90%;
    height: 12px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: var(--border-radius-sm);
    overflow: hidden;
    border: 1px solid rgba(var(--color-primary-rgb), 0.1);
}

#pomodoro-progress-bar, .progress-bar {
    width: 100%;
    height: 100%;
    background-color: var(--color-primary);
    border-radius: var(--border-radius-sm);
    transition: width 0.9s linear;
    box-shadow: 0 0 8px 1px var(--color-primary);
}

.pomodoro-count {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-top: var(--space-xs);
}

.pomodoro-controls {
    display: flex;
    gap: var(--space-md);
    margin-top: var(--space-sm);
}

.pomodoro-controls button {
    padding: var(--space-sm) var(--space-md);
    background: linear-gradient(135deg, 
        rgba(174, 255, 98, 0.3) 0%,
        rgba(51, 136, 204, 0.2) 100%);
    border: 1.5px solid var(--color-primary);
    color: var(--color-primary);
    font-family: var(--font-secondary);
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    height: 44px;
    min-width: 110px;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    box-shadow: 
        0 6px 16px rgba(0, 0, 0, 0.25),
        0 0 20px rgba(174, 255, 98, 0.12),
        inset 0 1px 1px rgba(255, 255, 255, 0.2);
    letter-spacing: 0.5px;
}

.pomodoro-controls button:hover, .pomodoro-controls button:focus {
    background: linear-gradient(135deg, 
        var(--color-primary) 0%,
        rgba(174, 255, 98, 0.85) 100%);
    color: #000;
    box-shadow: 
        0 10px 30px rgba(174, 255, 98, 0.35),
        0 0 50px rgba(174, 255, 98, 0.2),
        inset 0 1px 1px rgba(255, 255, 255, 0.3);
    outline: none;
    transform: translateY(-3px);
    border-color: var(--color-primary-light);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.pomodoro-controls button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: rgba(174, 255, 98, 0.08);
    color: var(--color-text-secondary);
    border-color: rgba(174, 255, 98, 0.15);
    box-shadow: none;
    transform: none;
}

.pomodoro-controls button ion-icon {
    font-size: 1.2em;
}

.pomodoro-settings {
    width: 100%;
    border-top: 1px dashed rgba(var(--color-primary-rgb), 0.2);
    padding-top: var(--space-sm);
    margin-top: var(--space-sm);
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    text-align: left;
    max-height: 450px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--color-primary) rgba(var(--color-primary-rgb), 0.2);
    background: linear-gradient(180deg, rgba(var(--color-primary-rgb), 0.05) 0%, transparent 100%);
    padding: var(--space-sm);
    border-radius: var(--border-radius-md);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.pomodoro-settings .setting-group {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-xxs) var(--space-xs);
    background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.08) 0%, rgba(var(--color-primary-rgb), 0.03) 100%);
    border-radius: var(--border-radius-sm);
    border: 1px solid rgba(var(--color-primary-rgb), 0.2);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: all var(--transition-speed-fast) ease;
}

.pomodoro-settings .setting-group:hover {
    background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.12) 0%, rgba(var(--color-primary-rgb), 0.06) 100%);
    border-color: rgba(var(--color-primary-rgb), 0.3);
}

.pomodoro-settings label {
    flex-grow: 1;
    color: var(--color-text-primary);
    font-size: 0.85rem;
}

.pomodoro-settings input[type="number"],
.pomodoro-settings input[type="range"] {
    width: 70px;
    padding: 4px 8px;
    background: rgba(var(--color-primary-rgb), 0.1);
    border: 1px solid rgba(var(--color-primary-rgb), 0.3);
    border-radius: var(--border-radius-sm);
    color: var(--color-primary);
    font-family: var(--font-primary);
    font-size: 0.8rem;
    text-align: center;
    -moz-appearance: textfield;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: all var(--transition-speed-fast) ease;
}

.pomodoro-settings input[type="number"]:focus,
.pomodoro-settings input[type="range"]:focus {
    background: rgba(var(--color-primary-rgb), 0.15);
    border-color: var(--color-primary);
    box-shadow: 0 0 8px rgba(var(--color-primary-rgb), 0.2);
}

.pomodoro-settings input[type="number"]::-webkit-outer-spin-button,
.pomodoro-settings input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.pomodoro-settings input[type="range"] {
    flex-grow: 0;
    width: 120px;
    height: 6px;
    background: transparent;
    cursor: pointer;
    border: none;
    padding: 0;
}

.pomodoro-settings input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 16px;
    width: 16px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
    margin-top: -5px;
    box-shadow: 0 0 5px rgba(var(--color-primary-rgb), 0.7);
    border: 1px solid rgba(var(--color-primary-rgb), 0.3);
}

.pomodoro-settings input[type="range"]::-moz-range-thumb {
    height: 16px;
    width: 16px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
    box-shadow: 0 0 5px rgba(var(--color-primary-rgb), 0.7);
    border: 1px solid rgba(var(--color-primary-rgb), 0.3);
}

.pomodoro-settings input[type="range"]::-webkit-slider-runnable-track {
    width: 100%;
    height: 6px;
    background: rgba(var(--color-primary-rgb), 0.2);
    border-radius: 3px;
    border: 1px solid rgba(var(--color-primary-rgb), 0.1);
}

.pomodoro-settings input[type="range"]::-moz-range-track {
    width: 100%;
    height: 6px;
    background: rgba(var(--color-primary-rgb), 0.2);
    border-radius: 3px;
    border: 1px solid rgba(var(--color-primary-rgb), 0.1);
}

.pomodoro-settings input[type="checkbox"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--color-primary);
    border-radius: 4px;
    background-color: rgba(var(--color-primary-rgb), 0.1);
    cursor: pointer;
    position: relative;
    transition: background-color var(--transition-speed-fast), border-color var(--transition-speed-fast);
}

.pomodoro-settings input[type="checkbox"]:checked {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
    box-shadow: 0 0 8px rgba(var(--color-primary-rgb), 0.5);
}

.pomodoro-settings input[type="checkbox"]:checked::after {
    content: '\2713';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--color-bg-dark);
    font-size: 1rem;
    font-weight: bold;
}

/* Collapsible Settings Styles */
.pomodoro-settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    padding: var(--space-xs);
    background-color: rgba(var(--color-primary-rgb), 0.08);
    border-radius: var(--border-radius-sm);
    margin-bottom: var(--space-xs);
    transition: background-color var(--transition-speed-fast);
    user-select: none;
}

.pomodoro-settings-header:hover {
    background-color: rgba(var(--color-primary-rgb), 0.15);
}

.pomodoro-settings-header h3 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.settings-toggle-icon {
    font-size: 1.2em;
    transition: transform 0.3s ease;
    color: var(--color-primary);
}

.settings-toggle-icon.collapsed {
    transform: rotate(-90deg);
}

.pomodoro-settings-content {
    max-height: 250px;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    opacity: 1;
}

.pomodoro-settings-content.collapsed {
    max-height: 0;
    opacity: 0;
}

.pomodoro-settings.collapsed .pomodoro-settings-content {
    overflow: hidden;
}

#toggle-dark-mode-btn {
    padding: var(--space-xs) var(--space-sm);
    background-color: rgba(var(--color-primary-rgb), 0.1);
    border: 1px solid rgba(var(--color-primary-rgb), 0.5);
    color: var(--color-primary);
    font-family: var(--font-secondary);
    font-weight: 500;
    font-size: 0.85rem;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: all var(--transition-speed-fast) ease;
    width: 100%;
    margin-top: var(--space-xs);
}

#toggle-dark-mode-btn:hover, #toggle-dark-mode-btn:focus {
    background-color: var(--color-primary);
    color: var(--color-bg-dark);
    box-shadow: 0 0 8px rgba(var(--color-primary-rgb), 0.4);
    outline: none;
}

.pomodoro-display.work .timer-mode {
    color: var(--pomodoro-work-color);
    text-shadow: 0 0 5px rgba(var(--pomodoro-work-color-rgb), 0.5);
    background-color: rgba(var(--pomodoro-work-color-rgb), 0.1);
}

.pomodoro-display.work #pomodoro-progress-bar,
.pomodoro-display.work .progress-bar {
    background-color: var(--pomodoro-work-color);
    box-shadow: 0 0 8px 1px var(--pomodoro-work-color);
}

.pomodoro-display.short-break .timer-mode {
    color: var(--pomodoro-short-break-color);
    text-shadow: 0 0 5px rgba(var(--pomodoro-short-break-color-rgb), 0.5);
    background-color: rgba(var(--pomodoro-short-break-color-rgb), 0.1);
}

.pomodoro-display.short-break #pomodoro-progress-bar,
.pomodoro-display.short-break .progress-bar {
    background-color: var(--pomodoro-short-break-color);
    box-shadow: 0 0 8px 1px var(--pomodoro-short-break-color);
}

.pomodoro-display.long-break .timer-mode {
    color: var(--pomodoro-long-break-color);
    text-shadow: 0 0 5px rgba(var(--pomodoro-long-break-color-rgb), 0.5);
    background-color: rgba(var(--pomodoro-long-break-color-rgb), 0.1);
}

.pomodoro-display.long-break #pomodoro-progress-bar,
.pomodoro-display.long-break .progress-bar {
    background-color: var(--pomodoro-long-break-color);
    box-shadow: 0 0 8px 1px var(--pomodoro-long-break-color);
}

/* Work Mode */
.pomodoro-display.work .timer-mode {
    color: var(--pomodoro-work-color);
    text-shadow: 0 0 5px rgba(var(--pomodoro-work-color-rgb), 0.5);
    background-color: rgba(var(--pomodoro-work-color-rgb), 0.15);
}

.pomodoro-display.work #pomodoro-progress-bar,
.pomodoro-display.work .progress-bar {
    background-color: var(--pomodoro-work-color);
    box-shadow: 0 0 8px 1px var(--pomodoro-work-color);
}

/* Short Break Mode */
.pomodoro-display.short-break .timer-mode {
    color: var(--pomodoro-short-break-color);
    text-shadow: 0 0 5px rgba(var(--pomodoro-short-break-color-rgb), 0.5);
    background-color: rgba(var(--pomodoro-short-break-color-rgb), 0.15);
}

.pomodoro-display.short-break #pomodoro-progress-bar,
.pomodoro-display.short-break .progress-bar {
    background-color: var(--pomodoro-short-break-color);
    box-shadow: 0 0 8px 1px var(--pomodoro-short-break-color);
}

/* Long Break Mode */
.pomodoro-display.long-break .timer-mode {
    color: var(--pomodoro-long-break-color);
    text-shadow: 0 0 5px rgba(var(--pomodoro-long-break-color-rgb), 0.5);
    background-color: rgba(var(--pomodoro-long-break-color-rgb), 0.15);
}

.pomodoro-display.long-break #pomodoro-progress-bar,
.pomodoro-display.long-break .progress-bar {
    background-color: var(--pomodoro-long-break-color);
    box-shadow: 0 0 8px 1px var(--pomodoro-long-break-color);
}

body.light-mode {
    --color-bg-dark: #f5f5f7;
    --color-text-primary: #1d1d1f;
    --color-text-secondary: #424245;
    --color-text-tertiary: #717174;
    --grid-line-color: rgba(0, 0, 0, 0.05);
}

body.light-mode #container {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.75) 0%,
        rgba(245, 250, 255, 0.6) 100%);
    box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.1),
        0 0 60px rgba(174, 255, 98, 0.08),
        inset 0 1px 2px rgba(255, 255, 255, 0.6);
    border-color: rgba(174, 255, 98, 0.3);
}

body.light-mode .left-column {
    background: linear-gradient(180deg, 
        rgba(174, 255, 98, 0.1) 0%, 
        transparent 100%);
}

body.light-mode .right-column {
    background: linear-gradient(180deg, 
        rgba(51, 136, 204, 0.06) 0%, 
        transparent 100%);
}

body.light-mode #audio-player {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.8) 0%,
        rgba(250, 250, 255, 0.65) 100%);
    border-color: rgba(174, 255, 98, 0.35);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12),
                0 0 30px rgba(174, 255, 98, 0.08);
}

body.light-mode #audio-player:hover {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.9) 0%,
        rgba(250, 250, 255, 0.75) 100%);
    border-color: rgba(174, 255, 98, 0.45);
}

body.light-mode .info-card {
    background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.8) 0%,
        rgba(250, 250, 255, 0.6) 100%);
    border-color: rgba(174, 255, 98, 0.4);
}

body.light-mode .info-card:hover {
    background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.9) 0%,
        rgba(250, 250, 255, 0.75) 100%);
    border-color: rgba(174, 255, 98, 0.55);
}

body.light-mode .card-icon {
    background: linear-gradient(135deg, 
        rgba(174, 255, 98, 0.35) 0%,
        rgba(51, 136, 204, 0.2) 100%);
    border-color: rgba(174, 255, 98, 0.4);
}

body.light-mode #pomodoro-progress-bar, body.light-mode .progress-bar {
    filter: brightness(0.85);
}

body.light-mode .pomodoro-controls button:hover, body.light-mode .pomodoro-controls button:focus {
    color: #000;
}

body.light-mode #todo-list li {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.7) 0%,
        rgba(250, 250, 255, 0.5) 100%);
    border-color: rgba(174, 255, 98, 0.3);
}

body.light-mode #todo-list li:hover {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.85) 0%,
        rgba(250, 250, 255, 0.65) 100%);
}

body.light-mode #todo-list li:hover {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.75) 0%, rgba(245, 245, 255, 0.55) 100%);
}
/* Shuffle and Repeat button styles */
#shuffle-btn, #repeat-btn {
    position: relative;
}

#shuffle-btn.active, #repeat-btn.active {
    color: var(--color-primary) !important;
}

#shuffle-btn.active::after, #repeat-btn.active::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    background-color: var(--color-primary);
    border-radius: 50%;
    box-shadow: 0 0 8px var(--color-primary);
}

/* Repeat one indicator */
#repeat-btn.repeat-one ion-icon {
    position: relative;
}

#repeat-btn.repeat-one::before {
    content: '1';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.7rem;
    font-weight: bold;
    color: var(--color-primary);
    pointer-events: none;
}
        </style>
    </head>
    <body>
        <div id="container">
            <div class="left-column">
                <div id="profile">
                    <div id="profile-image-wrapper">
                        <img id="avatar" src="https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg" alt="·∫¢nh ƒë·∫°i di·ªán anime c·ªßa HTCH"/>
                            <div class="profile-heart-badge">
                            <a
                                data-url="https://htch.is-a.dev/nguyet/index.html?id=eyJtZXNzYWdlIjoiRGFvIEFuaCBOZ3V5ZXQsVOG7myBUaMawxqFuZyBD4bqtdSzEkMOgbyDDgW5oIE5ndXnhu4d0LFThu5sgVGjDrWNoIEPhuq11LFThu5sgWcOqdSBD4bqtdSxU4bubIE3hur9uIEPhuq11LEkgTG92ZSBZb3UiLCJtdXNpYyI6Im0ubXAzIn0="
                                onclick="location.href=this.dataset.url"
                                style="cursor:pointer"
                                title="Don't forget to love yourself">
                            
                                <img src="https://raw.githubusercontent.com/twitter/twemoji/master/assets/svg/1f49c.svg">
                            </a>
                            </div>

                    </div>
                    <p id="username" data-text="@htch9999">@htch9999</p>
                    <div id="clock">00:00:00</div>

                    <!-- /// TIME, WEATHER, LOCATION & DATE WIDGET /// -->
                    <div id="info-widget-section">
                        <div class="info-card compact-info">
                            <!-- D√≤ng 1: L·ªãch -->
                            <div class="info-row">
                                <div class="info-item">
                                    <ion-icon name="calendar-outline" class="info-icon"></ion-icon>
                                    <span class="info-value" id="current-date">Loading...</span>
                                </div>
                            </div>
                            
                            <!-- Separator gi·ªØa 2 d√≤ng -->
                            <div class="info-row-separator"></div>
                            
                            <!-- D√≤ng 2: Th·ªùi ti·∫øt v√† V·ªã tr√≠ -->
                            <div class="info-row">
                                <div class="info-item">
                                    <ion-icon name="cloud-outline" class="info-icon"></ion-icon>
                                    <span class="info-value" id="weather-text">Loading...</span>
                                </div>
                                <div class="info-separator"></div>
                                <div class="info-item">
                                    <ion-icon name="location-outline" class="info-icon"></ion-icon>
                                    <span class="info-value" id="location-text">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /// END TIME, WEATHER, LOCATION & DATE WIDGET /// -->
                </div>
                <!-- /// AUDIO PLAYER /// -->
                <div id="audio-player">
                    <div class="track-info">
                        <span id="track-title" title="ƒêang t·∫£i nh·∫°c...">ƒêang t·∫£i nh·∫°c...</span>
                        <div class="progress-container">
                            <div id="progress-bar"></div>
                        </div>
                    </div>
                    <div class="controls">
                        <div class="main-controls">
                            <button id="shuffle-btn" aria-label="Shuffle" title="Shuffle">
                                <ion-icon name="shuffle-outline"></ion-icon>
                            </button>
                            <button id="prev-btn" aria-label="B√†i tr∆∞·ªõc" disabled>
                                <ion-icon name="play-skip-back-outline"></ion-icon>
                            </button>
                            <button id="play-pause-btn" aria-label="Ph√°t nh·∫°c" disabled>
                                <ion-icon name="play-outline"></ion-icon>
                            </button>
                            <button id="next-btn" aria-label="B√†i ti·∫øp theo" disabled>
                                <ion-icon name="play-skip-forward-outline"></ion-icon>
                            </button>
                            <button id="repeat-btn" aria-label="Repeat" title="Repeat Off">
                                <ion-icon name="repeat-outline"></ion-icon>
                            </button>
                        </div>
                    </div>
                    <!-- Container ·∫©n cho YouTube Player -->
                    <div id="youtube-player-container"></div>
                </div>
                <!-- /// END AUDIO PLAYER /// -->

                <!-- /// SOCIAL LINKS /// -->
                <div id="social-links" aria-label="Li√™n k·∫øt m·∫°ng x√£ h·ªôi kh√°c">
                    <a href="https://github.com/htch9999" target="_blank" rel="noopener noreferrer" aria-label="HTCH tr√™n Github" title="Github">
                        <ion-icon name="logo-github"></ion-icon>
                    </a>
                    <a href="https://youtube.com/@loif.ch.9999" target="_blank" rel="noopener noreferrer" aria-label="HTCH tr√™n Youtube" title="YouTube">
                        <ion-icon name="logo-youtube"></ion-icon>
                    </a>
                    <a href="https://facebook.com/htch.9999" target="_blank" rel="noopener noreferrer" aria-label="HTCH on Facebook" title="Facebook">
                        <ion-icon name="logo-facebook"></ion-icon>
                    </a>
                </div>
                <!-- /// FOOTER /// -->
                <footer>
                    <p>&copy; <span id="copyright-year"></span>. <a href="https://github.com/htch9999" target="_blank" rel="noopener noreferrer" style="color:#c3ff8a">htch9999</a> - All rights reserved.</p>
                    <script>
                        (function(){ 
                            const el = document.getElementById('copyright-year');
                            if(el) el.textContent = new Date().getFullYear();
                        })();
                    </script>
                </footer>
            </div>
            <div class="right-column">
                <div class="tabs-nav">
                    <button class="tab-link active" data-tab="todo-content" aria-controls="todo-content">To-Do List</button>
                    <button class="tab-link" data-tab="anime-content" aria-controls="anime-content">Discover Anime (VietSub)</button>
                    <button class="tab-link" data-tab="pomodoro-content" aria-controls="pomodoro-content">Pomodoro Timer</button>
                </div>

                <div id="todo-content" class="tab-content active" role="tabpanel">
                    <!-- /// TO-DO LIST SECTION /// -->
                    <section id="todo-section" aria-labelledby="todo-heading">
                        <h2 id="todo-heading" class="sci-fi-heading" style="display:none;">TO DO LIST</h2>
                        <form id="todo-form" aria-label="Add new tasks">
                            <div class="todo-input-group">
                                <input type="text" id="todo-input" placeholder="New tasks..." required aria-label="N·ªôi dung nhi·ªám v·ª•">
                                <input type="time" id="todo-time" aria-label="Th·ªùi gian nh·∫Øc nh·ªü" title="Ch·ªçn gi·ªù nh·∫Øc nh·ªü (trong ng√†y)">
                            </div>
                            <button type="submit" id="add-todo-btn" aria-label="Th√™m nhi·ªám v·ª•">
                                <ion-icon name="add-circle-outline"></ion-icon>
                                ADD
                            </button>
                        </form>
                        <ul id="todo-list" aria-live="polite">
                            <!-- Todo items appear here -->
                        </ul>
                        <button id="request-permission-btn" style="display: none;" aria-label="Y√™u c·∫ßu quy·ªÅn hi·ªÉn th·ªã th√¥ng b√°o">
                            <ion-icon name="notifications-outline"></ion-icon>
                            Allow Notifications
                        </button>
                    </section>
                    <!-- /// END TO-DO LIST /// -->
                </div>

                <div id="anime-content" class="tab-content" role="tabpanel">
                    <!-- === ANIME SEARCH SECTION === -->
                    <section id="anime-search-section" aria-labelledby="anime-search-heading">
                        <h2 id="anime-search-heading" class="sci-fi-heading" style="display:none;">DISCOVER ANIME</h2>
                        <div id="search-wrapper">
                            <input type="search" id="anime-search-input" placeholder="Loading data..." aria-label="Enter the name of the anime you want to find" disabled>
                            <button id="search-button" aria-label="Search" disabled>
                                <ion-icon name="search-outline"></ion-icon>
                            </button>
                        </div>
                        <div id="anime-results-container" aria-live="polite">
                            <p class="placeholder-text">Loading anime data...</p>
                        </div>
                        <div id="anime-episode-list-container">
                            <h3 id="episode-list-heading" class="sci-fi-heading" style="display: none;">Anime Title</h3>
                            <ul id="anime-episode-list" aria-live="polite"></ul>
                            <button id="back-to-search-btn" style="display: none;">
                                <ion-icon name="arrow-back-outline"></ion-icon>
                                Back
                            </button>
                        </div>
                    </section>
                    <!-- === END ANIME SEARCH SECTION === -->
                </div>

                <div id="pomodoro-content" class="tab-content" role="tabpanel">
                    <section id="pomodoro-section" aria-labelledby="pomodoro-heading">
                        <h2 id="pomodoro-heading" class="sci-fi-heading" style="display:none;">POMODORO TIMER</h2>
                        <div class="pomodoro-display">
                            <div class="timer-mode" data-mode="work">Work</div>
                            <div class="timer-value" id="timer-display">25:00</div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="pomodoro-progress-bar"></div>
                            </div>
                            <div class="pomodoro-count" id="pomodoro-count">Pomodoros: 0/4</div>
                        </div>

                        <div class="pomodoro-controls">
                            <button id="start-pause-btn" aria-label="Start Pomodoro">
                                <ion-icon name="play-outline"></ion-icon>
                                Start
                            </button>
                            <button id="reset-btn" aria-label="Reset Pomodoro">
                                <ion-icon name="refresh-outline"></ion-icon>
                                Reset
                            </button>
                            <button id="skip-btn" aria-label="Skip Break" style="display: none;">
                                <ion-icon name="play-skip-forward-outline"></ion-icon>
                                Skip
                            </button>
                        </div>

                        <div class="pomodoro-settings">
                        <div class="pomodoro-settings-header" id="settings-toggle">
                            <h3 class="sci-fi-heading">
                                <ion-icon name="chevron-down-outline" class="settings-toggle-icon"></ion-icon>
                                Settings
                            </h3>
                        </div>
                        <div class="pomodoro-settings-content">
                            <div class="setting-group">
                                <label for="work-duration">Work (min):</label>
                                <input type="number" id="work-duration" value="25" min="1" max="60">
                            </div>
                            <div class="setting-group">
                                <label for="short-break-duration">Short Break (min):</label>
                                <input type="number" id="short-break-duration" value="5" min="1" max="30">
                            </div>
                            <div class="setting-group">
                                <label for="long-break-duration">Long Break (min):</label>
                                <input type="number" id="long-break-duration" value="15" min="1" max="60">
                            </div>
                            <div class="setting-group">
                                <label for="auto-start-breaks">Auto start breaks:</label>
                                <input type="checkbox" id="auto-start-breaks">
                            </div>
                            <div class="setting-group">
                                <label for="auto-start-pomodoros">Auto start pomodoros:</label>
                                <input type="checkbox" id="auto-start-pomodoros">
                            </div>
                            <div class="setting-group">
                                <label for="sound-volume">Sound Volume:</label>
                                <input type="range" id="sound-volume" min="0" max="1" step="0.1" value="0.8">
                            </div>
<!--                             <div class="setting-group">
                                    <button id="toggle-dark-mode-btn">Toggle Dark Mode</button>
                                </div> -->
                        </div> <!-- Close pomodoro-settings-content -->
                    </div> <!-- Close pomodoro-settings -->
                </section>
                </div>

            </div>
        </div>
        <!-- End #container -->
        <!-- === IFRAME PLAYER CONTAINER (Anime Viewer) === -->
        <div id="anime-player-container">
            <button id="close-player-btn" aria-label="ƒê√≥ng tr√¨nh ph√°t">
                <ion-icon name="close-circle-outline"></ion-icon>
            </button>
            <h4 id="player-anime-title">Anime Title - Episode Name</h4>
            <div class="iframe-wrapper">
                <iframe id="anime-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="Anime Player"></iframe>
            </div>
        </div>
        <!-- === END IFRAME PLAYER CONTAINER === -->
        <script>
            //********* JAVASCRIPT - VERSION 13.0 (YouTube Integration) *********//
            document.addEventListener('DOMContentLoaded', () => {
                // --- CONFIGURATION ---
                const introStaggerDelay = 70;
                const glitchEffectOnLoad = true;
                const glitchDuration = 1500;
                const ANIME_DATA_URL = 'https://raw.githubusercontent.com/harunguyenvn-dev/data/refs/heads/main/anime.csv';

                // --- *** PLAYLIST DATA (MP3 Links & YouTube Video IDs) *** ---
                const playlist = [// type: 'url' (ng·∫ßm ƒë·ªãnh)
                {
                    type: 'youtube',
                    videoId: 'SKWxqYvqmmA',
                    title: 'Spring Snow'
                }, {
                    type: 'youtube',
                    videoId: 'nd50zEIDK40',
                    title: 'Like I Do'
                }, {
                    type: 'youtube',
                    videoId: '3k8RQK8OoI4',
                    title: 'Gamble'
                }, {
                    type: 'youtube',
                    videoId: 'uQiF1yOnzDg',
                    title: 'Double Take'
                }, {
                    type: 'youtube',
                    videoId: 'QwiuihFPPok',
                    title: 'Tonight'
                }, {
                    type: 'youtube',
                    videoId: 'r9ocxIygXWo',
                    title: 'At My Worst'
                }, {
                    type: 'youtube',
                    videoId: 'HsM9VucuCtw',
                    title: 'Shadow Of The Sun'
                }, {
                    type: 'youtube',
                    videoId: '4Es3ezjU278',
                    title: 'No Reason'
                }, {
                    type: 'youtube',
                    videoId: 'QBfmsBgs2yE',
                    title: 'love me from a distance'
                }, {
                    type: 'youtube',
                    videoId: 'G5ayUzEesb0',
                    title: 'wish u were gone'
                }, {
                    type: 'youtube',
                    videoId: 'iTRM_5v2GVQ',
                    title: 'Love Is Gone'
                }, {
                    type: 'youtube',
                    videoId: '3DNJbEH22A0',
                    title: 'Never Let This Go'
                }, {
                    type: 'youtube',
                    videoId: 'yWHrYNP6j4k',
                    title: 'Stay'
                }, {
                    type: 'youtube',
                    videoId: '12gmxhEFeBo',
                    title: 'Payphone'
                }, {
                    type: 'youtube',
                    videoId: 'p7CuxzGWY40',
                    title: 'Dont Leave Sped Up'
                }, {
                    type: 'youtube',
                    videoId: '33YjUPqiQEo',
                    title: 'Dive Back In Time'
                }, {
                    type: 'youtube',
                    videoId: 'Ymts4ldfPws',
                    title: 'Seasons'
                }, {
                    type: 'youtube',
                    videoId: 'oOi3oJmfz4o',
                    title: 'Royalty'
                }, {
                    type: 'youtube',
                    videoId: 'KgayxOF4Y7E',
                    title: 'PASSO BEM SOLTO'
                }, {
                    type: 'youtube',
                    videoId: 'kZD8Ba6uuYg',
                    title: 'Run To You'
                }, {
                    type: 'youtube',
                    videoId: '5L9z63AwVsw',
                    title: 'Ë∂ÖÁáÉ‰∏ªÈ¢òÊõ≤Êù•Ë¢≠ÔºÅ'
                }, {
                    type: 'youtube',
                    videoId: 'KgayxOF4Y7E',
                    title: 'PASSO BEM SOLTO'
                }, {
                    type: 'youtube',
                    videoId: 'KgayxOF4Y7E',
                    title: 'PASSO BEM SOLTO'
                }, {
                    type: 'youtube',
                    videoId: 'KgayxOF4Y7E',
                    title: 'PASSO BEM SOLTO'
                },
                ];

                // --- GET DOM ELEMENTS ---
                const container = document.getElementById('container');
                const clockElement = document.getElementById('clock');
                const usernameElement = document.getElementById('username');
                const avatar = document.getElementById('avatar');
                const todoSection = document.getElementById('todo-section');
                const todoForm = document.getElementById('todo-form');
                const todoInput = document.getElementById('todo-input');
                const todoTimeInput = document.getElementById('todo-time');
                const todoListElement = document.getElementById('todo-list');
                const requestPermissionBtn = document.getElementById('request-permission-btn');
                const audioPlayer = document.getElementById('audio-player');
                const playPauseBtn = document.getElementById('play-pause-btn');
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                const playIcon = playPauseBtn?.querySelector('ion-icon');
                const progressBar = document.getElementById('progress-bar');
                const progressContainer = audioPlayer?.querySelector('.progress-container');
                const trackTitleElement = document.getElementById('track-title');
                const mainLinks = document.querySelectorAll('#links a');
                const socialLinksContainer = document.getElementById('social-links');
                const footerElement = document.querySelector('footer');
                const animeSearchSection = document.getElementById('anime-search-section');
                const searchInput = document.getElementById('anime-search-input');
                const searchButton = document.getElementById('search-button');
                const resultsContainer = document.getElementById('anime-results-container');
                const episodeListContainer = document.getElementById('anime-episode-list-container');
                const episodeListHeading = document.getElementById('episode-list-heading');
                const episodeListUl = document.getElementById('anime-episode-list');
                const playerContainer = document.getElementById('anime-player-container');
                const playerIframe = document.getElementById('anime-iframe');
                const playerTitle = document.getElementById('player-anime-title');
                const closePlayerBtn = document.getElementById('close-player-btn');
                const backToSearchBtn = document.getElementById('back-to-search-btn');
                const youtubePlayerContainer = document.getElementById('youtube-player-container');
                const tabsNav = document.querySelector('.tabs-nav');
                const tabContents = document.querySelectorAll('.tab-content');
                // YouTube player will attach here

                // --- STATE VARIABLES ---
                let audio = null;
                let currentTrackIndex = -1;
                let isPlaying = false;
                let userHasInteracted = false;
                let playAfterLoad = false;
                let tasks = [];
                let notificationPermission = 'Notification'in window ? Notification.permission : 'unsupported';
                let clockInterval = null;
                let allEpisodeRecords = [];
                let currentAnimeTitle = '';
                let youtubePlayer = null;
                let youtubeApiReady = false;
                let youtubePlayerReady = false;
                let youtubeProgressInterval = null;
                let currentPlayerType = 'none';
                let isShuffleOn = false;
                let repeatMode = 'off'; // 'off', 'all', 'one'
                let shuffledPlaylist = [];
                let originalPlaylist = [];
                // 'url', 'youtube', 'none'

                // ============================
                // === HELPER FUNCTIONS ===
                // ============================
                // === SHUFFLE & REPEAT FUNCTIONS ===
                function shuffleArray(array) {
                    const shuffled = [...array]; // T·∫°o b·∫£n sao
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                }

                function toggleShuffle() {
                    const shuffleBtn = document.getElementById('shuffle-btn');
                    isShuffleOn = !isShuffleOn;
                    
                    if (isShuffleOn) {
                        console.log("üîÄ Shuffle ON");
                        
                        // L∆∞u playlist g·ªëc N·∫æU ch∆∞a c√≥
                        if (originalPlaylist.length === 0) {
                            originalPlaylist = [...playlist];
                        }
                        
                        // L·∫•y b√†i ƒëang ph√°t hi·ªán t·∫°i
                        const currentTrack = currentTrackIndex >= 0 ? playlist[currentTrackIndex] : null;
                        
                        // Shuffle c√°c b√†i c√≤n l·∫°i (tr·ª´ b√†i ƒëang ph√°t)
                        const otherTracks = playlist.filter((_, idx) => idx !== currentTrackIndex);
                        const shuffled = shuffleArray(otherTracks);
                        
                        // X√¢y d·ª±ng playlist m·ªõi: b√†i hi·ªán t·∫°i + c√°c b√†i ƒë√£ shuffle
                        const newPlaylist = currentTrack ? [currentTrack, ...shuffled] : shuffled;
                        
                        // C·∫≠p nh·∫≠t playlist
                        playlist.length = 0;
                        playlist.push(...newPlaylist);
                        
                        // Reset index v·ªÅ 0 (b√†i hi·ªán t·∫°i)
                        if (currentTrack) {
                            currentTrackIndex = 0;
                        }
                        
                        shuffleBtn?.classList.add('active');
                    } else {
                        console.log("‚û°Ô∏è Shuffle OFF");
                        
                        // Kh√¥i ph·ª•c playlist g·ªëc
                        if (originalPlaylist.length > 0) {
                            const currentTrack = currentTrackIndex >= 0 ? playlist[currentTrackIndex] : null;
                            
                            // T√¨m v·ªã tr√≠ g·ªëc c·ªßa b√†i ƒëang ph√°t
                            let originalIndex = 0;
                            if (currentTrack) {
                                originalIndex = originalPlaylist.findIndex(t => 
                                    (t.videoId && t.videoId === currentTrack.videoId) || 
                                    (t.url && t.url === currentTrack.url) ||
                                    (t.title && t.title === currentTrack.title)
                                );
                                if (originalIndex < 0) originalIndex = 0;
                            }
                            
                            // Kh√¥i ph·ª•c playlist g·ªëc
                            playlist.length = 0;
                            playlist.push(...originalPlaylist);
                            currentTrackIndex = originalIndex;
                            
                            // X√≥a b·∫£n sao g·ªëc
                            originalPlaylist = [];
                        }
                        
                        shuffleBtn?.classList.remove('active');
                    }
                    
                    updatePrevNextButtonStates();
                    savePlayerState();
                }

                function toggleRepeat() {
                    const repeatBtn = document.getElementById('repeat-btn');
                    const icon = repeatBtn?.querySelector('ion-icon');
                    
                    // Cycle: off -> all -> one -> off
                    if (repeatMode === 'off') {
                        repeatMode = 'all';
                        repeatBtn?.classList.add('active');
                        repeatBtn?.classList.remove('repeat-one');
                        repeatBtn?.setAttribute('title', 'Repeat All');
                        console.log("üîÅ Repeat ALL");
                    } else if (repeatMode === 'all') {
                        repeatMode = 'one';
                        repeatBtn?.classList.add('active', 'repeat-one');
                        repeatBtn?.setAttribute('title', 'Repeat One');
                        if (icon) icon.setAttribute('name', 'repeat-outline');
                        console.log("üîÇ Repeat ONE");
                    } else {
                        repeatMode = 'off';
                        repeatBtn?.classList.remove('active', 'repeat-one');
                        repeatBtn?.setAttribute('title', 'Repeat Off');
                        console.log("‚û°Ô∏è Repeat OFF");
                    }
                    
                    savePlayerState();
                }

                function savePlayerState() {
                    if (!window.localStorage) return;
                    try {
                        localStorage.setItem('musicPlayerState', JSON.stringify({
                            isShuffleOn,
                            repeatMode,
                            currentTrackIndex,
                            volume: audio?.volume ?? 0.8
                        }));
                    } catch (e) {
                        console.error("Save player state error:", e);
                    }
                }

                function loadPlayerState() {
                    if (!window.localStorage) return;
                    try {
                        const saved = localStorage.getItem('musicPlayerState');
                        if (!saved) return; // Kh√¥ng c√≥ state -> kh√¥ng load g√¨ c·∫£
                        
                        const state = JSON.parse(saved);
                        
                        // Load repeat mode
                        repeatMode = state.repeatMode || 'off';
                        const repeatBtn = document.getElementById('repeat-btn');
                        if (repeatMode !== 'off' && repeatBtn) {
                            repeatBtn.classList.add('active');
                            if (repeatMode === 'one') {
                                repeatBtn.classList.add('repeat-one');
                                repeatBtn.setAttribute('title', 'Repeat One');
                            } else {
                                repeatBtn.setAttribute('title', 'Repeat All');
                            }
                        }
                        
                        // Load shuffle state (KH√îNG t·ª± ƒë·ªông shuffle, ch·ªâ hi·ªÉn th·ªã tr·∫°ng th√°i)
                        isShuffleOn = state.isShuffleOn || false;
                        const shuffleBtn = document.getElementById('shuffle-btn');
                        if (isShuffleOn && shuffleBtn) {
                            shuffleBtn.classList.add('active');
                        }
                        
                        // Load volume
                        if (state.volume !== undefined && audio) {
                            audio.volume = state.volume;
                        }
                        
                        console.log("‚úÖ Player state loaded:", { isShuffleOn, repeatMode });
                    } catch (e) {
                        console.error("Load player state error:", e);
                    }
                }

                function generateId() {
                    return Date.now().toString(36) + Math.random().toString(36).substring(2, 7);
                }
                function formatTimeForDisplay(date) {
                    if (!date || !(date instanceof Date) || isNaN(date))
                        return null;
                    try {
                        const hours = String(date.getHours()).padStart(2, '0');
                        const minutes = String(date.getMinutes()).padStart(2, '0');
                        return `${hours}:${minutes}`;
                    } catch (e) {
                        console.error("L·ªói ƒë·ªãnh d·∫°ng gi·ªù:", e);
                        return null;
                    }
                }
                function setPrimaryColorRGB() {
                    if (typeof window === 'undefined' || !document?.documentElement)
                        return;
                    try {
                        const s = window.getComputedStyle(document.documentElement);
                        let c = s.getPropertyValue('--color-primary').trim();
                        let r = 225
                          , g = 29
                          , b = 72;
                        if (c.startsWith('#')) {
                            const h = c.substring(1);
                            if (h.length === 3) {
                                r = parseInt(h[0] + h[0], 16);
                                g = parseInt(h[1] + h[1], 16);
                                b = parseInt(h[2] + h[2], 16);
                            } else if (h.length === 6) {
                                r = parseInt(h.substring(0, 2), 16);
                                g = parseInt(h.substring(2, 4), 16);
                                b = parseInt(h.substring(4, 6), 16);
                            }
                        } else if (c.startsWith('rgb')) {
                            const p = c.match(/(\d+)/g);
                            if (p && p.length >= 3) {
                                r = parseInt(p[0], 10);
                                g = parseInt(p[1], 10);
                                b = parseInt(p[2], 10);
                            }
                        }
                        if (isNaN(r) || isNaN(g) || isNaN(b)) {
                            [r,g,b] = [225, 29, 72];
                            console.warn("Cannot parse primary color, using default.");
                        }
                        document.documentElement.style.setProperty('--color-primary-rgb', `${r}, ${g}, ${b}`);
                    } catch (e) {
                        console.error("Error setting primary RGB:", e);
                        document.documentElement.style.setProperty('--color-primary-rgb', `225, 29, 72`);
                    }
                }
                function splitCsvLine(line) {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            if (inQuotes && line[i + 1] === '"') {
                                current += '"';
                                i++;
                            } else {
                                inQuotes = !inQuotes;
                            }
                        } else if (char === ',' && !inQuotes) {
                            result.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current);
                    return result;
                }
                function parseCSV_NameEpisodeLink(csvText) {
                    if (!csvText)
                        return [];
                    const lines = csvText.trim().split('\n');
                    if (lines.length <= 1)
                        return [];
                    const header = lines[0].split(',').map(h => h.trim().toLowerCase());
                    const data = [];
                    const nameIndex = header.indexOf('name');
                    const episodeNameIndex = header.indexOf('episodes');
                    const linkIndex = header.indexOf('link');
                    if (nameIndex === -1 || episodeNameIndex === -1 || linkIndex === -1) {
                        console.error("‚ùå Critical Error: CSV must contain 'name', 'episodes', 'link'. Header:", header.join(', '));
                        if (resultsContainer)
                            resultsContainer.innerHTML = '<p class="placeholder-text error">L·ªói c·∫•u tr√∫c file d·ªØ li·ªáu.</p>';
                        return [];
                    }
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line)
                            continue;
                        try {
                            const parts = splitCsvLine(line);
                            if (parts.length <= Math.max(nameIndex, episodeNameIndex, linkIndex)) {
                                console.warn(`‚ö†Ô∏è Skipping line ${i + 1}: Not enough columns. "${line.substring(0, 50)}..."`);
                                continue;
                            }
                            const animeName = parts[nameIndex]?.trim();
                            const episodeName = parts[episodeNameIndex]?.trim();
                            const link = parts[linkIndex]?.trim();
                            if (!animeName || !episodeName) {
                                console.warn(`‚ö†Ô∏è Skipping line ${i + 1}: Missing name/episode. Name: '${animeName}', Ep: '${episodeName}'`);
                                continue;
                            }
                            data.push({
                                animeName: animeName,
                                episodeName: episodeName,
                                link: link || '#'
                            });
                        } catch (e) {
                            console.error(`‚ùå Error CSV line ${i + 1}: "${line.substring(0, 100)}...". Error: ${e.message}`);
                        }
                    }
                    console.log(`‚ÑπÔ∏è Parsed ${data.length} episode records.`);
                    return data;
                }
                function formatTimeForDisplayYT(seconds) {
                    if (isNaN(seconds) || seconds < 0)
                        return '0:00';
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
                }

                // ============================
                // === LOCATION & WEATHER FUNCTIONS ===
                // ============================
                async function loadLocationAndWeather() {
                    const locationElement = document.getElementById('location');
                    const weatherElement = document.getElementById('weather');

                    if (!locationElement || !weatherElement) return;

                    // 1. Get Location
                    if (!navigator.geolocation) {
                        locationElement.textContent = 'Browser does not support location.';
                        weatherElement.style.display = 'none';
                        return;
                    }

                    navigator.geolocation.getCurrentPosition(async (position) => {
                        const { latitude, longitude } = position.coords;

                        // 2. Fetch Weather & Location Info
                        try {
                            // Using Open-Meteo API (no key required)
                            const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`);
                            if (!weatherResponse.ok) throw new Error('Weather API Error');
                            const weatherData = await weatherResponse.json();
                            
                            // Using a free reverse geocoding API to get city name
                            const locationResponse = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                            if (!locationResponse.ok) throw new Error('Location API Error');
                            const locationData = await locationResponse.json();

                            const city = locationData.address.city || locationData.address.town || locationData.address.village || 'V·ªã tr√≠ kh√¥ng x√°c ƒë·ªãnh';
                            const temperature = weatherData.current_weather.temperature;
                            const weatherCode = weatherData.current_weather.weathercode;

                            // Simple weather code to icon mapping
                            const weatherIcons = {
                                0: 'sunny-outline', // Clear sky
                                1: 'partly-sunny-outline', // Mainly clear
                                2: 'partly-sunny-outline', // partly cloudy
                                3: 'cloud-outline', // overcast
                                45: 'fog-outline', // Fog
                                48: 'fog-outline', // depositing rime fog
                                51: 'rainy-outline', // Drizzle light
                                53: 'rainy-outline', // Drizzle moderate
                                55: 'rainy-outline', // Drizzle dense
                                61: 'rainy-outline', // Rain slight
                                63: 'rainy-outline', // Rain moderate
                                65: 'rainy-outline', // Rain heavy
                                80: 'rainy-outline', // Showers slight
                                81: 'rainy-outline', // Showers moderate
                                82: 'rainy-outline', // Showers violent
                                95: 'thunderstorm-outline', // Thunderstorm
                            };
                            const iconName = weatherIcons[weatherCode] || 'cloud-outline';

                            locationElement.innerHTML = `<ion-icon name="location-outline"></ion-icon> ${city}`;
                            weatherElement.innerHTML = `<ion-icon name="${iconName}"></ion-icon> ${temperature}¬∞C`;

                        } catch (error) {
                            console.error("Error getting weather/location data:", error);
                            locationElement.textContent = 'Unable to get data.';
                            weatherElement.style.display = 'none';
                        }

                    }, (error) => {
                        console.error("Positioning error:", error.message);
                        locationElement.innerHTML = `<ion-icon name="alert-circle-outline"></ion-icon> Please grant location permission.`;
                        weatherElement.style.display = 'none';
                    });
                }


                // ============================
                // === YOUTUBE API FUNCTIONS ===
                // ============================
                function loadYouTubeAPI() {
                    console.log("‚ñ∂Ô∏è Loading YouTube API...");
                    var tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                }

                window.onYouTubeIframeAPIReady = function() {
                    console.log("‚úÖ YouTube API Script Ready");
                    youtubeApiReady = true;
                }

                function onPlayerReady(event) {
                    console.log("‚úÖ YT Player Instance Ready (onReady). State:", event.target.getPlayerState());
                    youtubePlayerReady = true;
                    enableMainControls();
                    updatePrevNextButtonStates();
                    setYouTubeVolume(audio?.volume ?? 0.8);
                    // Sync volume
                    if (playAfterLoad) {
                        console.log("onPlayerReady: playAfterLoad=true -> Playing YT video...");
                        playAudio();
                    } else {
                        updateYouTubeProgressAndDuration();
                        // Update initial state
                    }
                }

                function onPlayerStateChange(event) {
                    const state = event.data;
                    const stateName = Object.keys(YT.PlayerState).find(key => YT.PlayerState[key] === state) || 'UNKNOWN';
                    console.log(`YT State Change: ${stateName} (${state})`);

                    if (state === YT.PlayerState.PLAYING) {
                        if (!youtubePlayerReady)
                            youtubePlayerReady = true;
                        if (!isPlaying) {
                            isPlaying = true;
                            updatePlayPauseButton(true);
                            container?.classList.add('is-playing');
                            if (!youtubeProgressInterval)
                                startYouTubeProgressTracking();
                        }
                    } else if (state === YT.PlayerState.PAUSED) {
                        if (isPlaying) {
                            isPlaying = false;
                            updatePlayPauseButton(false);
                            container?.classList.remove('is-playing');
                            if (youtubeProgressInterval) {
                                clearInterval(youtubeProgressInterval);
                                youtubeProgressInterval = null;
                            }
                        }
                    } else if (state === YT.PlayerState.ENDED) {
                        isPlaying = false;
                        youtubePlayerReady = false;
                        // Treat as not ready for new track load
                        updatePlayPauseButton(false);
                        container?.classList.remove('is-playing');
                        if (progressBar)
                            progressBar.style.width = '100%';
                        if (youtubeProgressInterval) {
                            clearInterval(youtubeProgressInterval);
                            youtubeProgressInterval = null;
                        }
                        playNextTrack(true);
                        // Auto-advance
                    } else if (state === YT.PlayerState.BUFFERING) {// Optionally handle buffering state (e.g., show loading indicator)
                    } else if (state === YT.PlayerState.CUED) {
                        if (!youtubePlayerReady)
                            youtubePlayerReady = true;
                        enableMainControls();
                        updatePrevNextButtonStates();
                        updateYouTubeProgressAndDuration();
                        if (youtubeProgressInterval && !isPlaying) {
                            clearInterval(youtubeProgressInterval);
                            youtubeProgressInterval = null;
                        }
                    } else if (state === YT.PlayerState.UNSTARTED) {
                        if (youtubeProgressInterval) {
                            clearInterval(youtubeProgressInterval);
                            youtubeProgressInterval = null;
                        }
                    }

                    // General re-enabling of controls if player is interactive
                    if ([YT.PlayerState.PLAYING, YT.PlayerState.PAUSED, YT.PlayerState.CUED].includes(state)) {
                        if (!youtubePlayerReady)
                            youtubePlayerReady = true;
                        enableMainControls();
                        updatePrevNextButtonStates();
                    }
                }

                function onPlayerError(event) {
                    console.error("YT Player Error Code:", event.data);
                    let errorMsg = `L·ªói YT Player (${event.data})`;
                    if (event.data === 2)
                        errorMsg = "ID Video kh√¥ng h·ª£p l·ªá";
                    else if (event.data === 5)
                        errorMsg = "L·ªói tr√¨nh ph√°t HTML5";
                    else if (event.data === 100)
                        errorMsg = "Kh√¥ng t√¨m th·∫•y video";
                    else if (event.data === 101 || event.data === 150)
                        errorMsg = "Video ri√™ng t∆∞ ho·∫∑c b·ªã ch·∫∑n";
                    if (trackTitleElement) {
                        trackTitleElement.textContent = errorMsg;
                        trackTitleElement.classList.remove('is-youtube');
                    }
                    disableAllControls();
                    isPlaying = false;
                    youtubePlayerReady = false;
                    currentPlayerType = 'none';
                    updatePlayPauseButton(false);
                    container?.classList.remove('is-playing');
                    if (youtubeProgressInterval) {
                        clearInterval(youtubeProgressInterval);
                        youtubeProgressInterval = null;
                    }
                }

                function startYouTubeProgressTracking() {
                    if (youtubeProgressInterval)
                        clearInterval(youtubeProgressInterval);
                    youtubeProgressInterval = setInterval(updateYouTubeProgressAndDuration, 1000);
                }

                function updateYouTubeProgressAndDuration() {
                    if (currentPlayerType === 'youtube' && youtubePlayer && youtubePlayerReady && typeof youtubePlayer.getCurrentTime === 'function' && typeof youtubePlayer.getDuration === 'function') {
                        const currentTime = youtubePlayer.getCurrentTime();
                        const duration = youtubePlayer.getDuration();
                        if (duration > 0 && !isNaN(currentTime) && !isNaN(duration)) {
                            if (progressBar)
                                progressBar.style.width = `${(currentTime / duration) * 100}%`;
                            // Update time display if needed (using your existing time elements or new ones)
                            // e.g., document.getElementById('current-time').textContent = formatTimeForDisplayYT(currentTime);
                            // e.g., document.getElementById('total-time').textContent = formatTimeForDisplayYT(duration);
                        } else if (duration <= 0 && progressBar) {
                            progressBar.style.width = '0%';
                            // Indicate live stream or error
                        }
                    } else if (currentPlayerType !== 'youtube' && youtubeProgressInterval) {
                        clearInterval(youtubeProgressInterval);
                        youtubeProgressInterval = null;
                    }
                }

                function setYouTubeVolume(volume) {
                    if (youtubePlayer && youtubePlayerReady && typeof youtubePlayer.setVolume === 'function') {
                        youtubePlayer.setVolume(Math.round(volume * 100));
                    }
                }

                // ============================
                // === CORE PLAYER LOGIC (Unified) ===
                // ============================

                function loadTrack(index) {
                    if (!playlist || index < 0 || index >= playlist.length) {
                        console.error("Load track failed: Invalid index or empty playlist.");
                        if (trackTitleElement)
                            trackTitleElement.textContent = playlist?.length ? "L·ªói Index" : "Playlist Tr·ªëng";
                        trackTitleElement?.classList.remove('is-youtube');
                        disableAllControls();
                        currentPlayerType = 'none';
                        currentTrackIndex = -1;
                        return;
                    }
                    console.log(`--- Loading Track ${index} ---`);
                    // Stop previous playback
                    if (audio && !audio.paused)
                        audio.pause();
                    if (youtubePlayer && youtubePlayerReady && typeof youtubePlayer.stopVideo === 'function') {
                        youtubePlayer.stopVideo();
                        if (youtubeProgressInterval) {
                            clearInterval(youtubeProgressInterval);
                            youtubeProgressInterval = null;
                        }
                    }

                    // Reset common state
                    isPlaying = false;
                    playAfterLoad = false;
                    youtubePlayerReady = false;
                    currentTrackIndex = index;
                    updatePlayPauseButton(false);
                    if (progressBar)
                        progressBar.style.width = '0%';
                    container?.classList.remove('is-playing');
                    disableAllControls();

                    const track = playlist[currentTrackIndex];
                    const trackType = track.type || 'url';
                    currentPlayerType = trackType;
                    const displayTitle = track.title || (trackType === 'youtube' ? `YouTube: ${track.videoId}` : `Track ${index + 1}`);
                    if (trackTitleElement) {
                        trackTitleElement.textContent = displayTitle;
                        trackTitleElement.title = displayTitle;
                        trackTitleElement.classList.toggle('is-youtube', trackType === 'youtube');
                    }

                    if (trackType === 'youtube') {
                        console.log(`Type: YouTube, Video ID: ${track.videoId}`);
                        if (!track.videoId) {
                            if (trackTitleElement)
                                trackTitleElement.textContent = "L·ªói ID YouTube";
                            currentPlayerType = 'none';
                            return;
                        }
                        if (audio && audio.src) {
                            // Reset audio element if was used
                            audio.removeAttribute('src');
                            try {
                                audio.load();
                            } catch (e) {
                                console.warn("Minor error resetting audio:", e);
                            }
                        }
                        if (youtubePlayer && typeof youtubePlayer.loadVideoById === 'function') {
                            // Reuse player
                            if (youtubeApiReady)
                                youtubePlayer.loadVideoById(track.videoId);
                                // Don't autoplay here
                            else {
                                if (trackTitleElement)
                                    trackTitleElement.textContent = "L·ªói API YT...";
                                currentPlayerType = 'none';
                            }
                        } else if (youtubeApiReady) {
                            // Create new player
                            youtubePlayer = new YT.Player('youtube-player-container',{
                                height: '1',
                                width: '1',
                                videoId: track.videoId,
                                playerVars: {
                                    'playsinline': 1,
                                    'autoplay': 0,
                                    'controls': 0,
                                    'disablekb': 1,
                                    'fs': 0,
                                    'iv_load_policy': 3,
                                    'modestbranding': 1,
                                    'rel': 0
                                },
                                events: {
                                    'onReady': onPlayerReady,
                                    'onStateChange': onPlayerStateChange,
                                    'onError': onPlayerError
                                }
                            });
                        } else {
                            console.warn("Cannot load YouTube: API not ready yet.");
                            if (trackTitleElement)
                                trackTitleElement.textContent = "Ch·ªù API YouTube...";
                            currentPlayerType = 'none';
                        }
                    } else {
                        // url track
                        console.log(`Type: URL, Source: ${track.url}`);
                        if (!track.url) {
                            if (trackTitleElement)
                                trackTitleElement.textContent = "L·ªói URL Track";
                            currentPlayerType = 'none';
                            return;
                        }
                        if (typeof Audio === 'undefined') {
                            if (trackTitleElement)
                                trackTitleElement.textContent = "L·ªói Audio HTML5";
                            currentPlayerType = 'none';
                            return;
                        }
                        if (!audio) {
                            // Create Audio element if needed
                            try {
                                audio = new Audio();
                                audio.preload = 'metadata';
                                addAudioListeners();
                            } // Add listeners ONLY once
                            catch (e) {
                                console.error("Cannot create Audio obj:", e);
                                if (trackTitleElement)
                                    trackTitleElement.textContent = "L·ªói Audio";
                                currentPlayerType = 'none';
                                return;
                            }
                        }
                        try {
                            console.log("Setting audio src & load...");
                            audio.src = track.url;
                            audio.load();
                        } // 'canplay' event handles enabling controls
                        catch (e) {
                            console.error("Audio src/load error:", e);
                            if (trackTitleElement)
                                trackTitleElement.textContent = "L·ªói Load Audio";
                            disableAllControls();
                            currentPlayerType = 'none';
                        }
                    }
                }

                function addAudioListeners() {
                    // Attached only once to the Audio object
                    if (!audio)
                        return;
                    console.log("Attaching listeners to Audio element.");
                    audio.addEventListener('timeupdate', () => {
                        if (currentPlayerType === 'url' && audio.duration && !isNaN(audio.duration) && progressBar && isPlaying)
                            progressBar.style.width = `${(audio.currentTime / audio.duration) * 100}%`;
                    }
                    );
                    audio.addEventListener('ended', () => {
                        if (currentPlayerType === 'url') {
                            isPlaying = false;
                            updatePlayPauseButton(false);
                            container?.classList.remove('is-playing');
                            playNextTrack(true);
                        }
                    }
                    );
                    audio.addEventListener('error', (e) => {
                        if (currentPlayerType === 'url') {
                            let m = "Err";
                            if (audio.error) {
                                switch (audio.error.code) {
                                case 1:
                                    m = 'Abort';
                                    break;
                                case 2:
                                    m = 'Net';
                                    break;
                                case 3:
                                    m = 'Decode';
                                    break;
                                case 4:
                                    m = 'Format';
                                    break;
                                default:
                                    m = `${audio.error.code}`
                                }
                            }
                            console.error("Audio Err:", m, e);
                            if (trackTitleElement)
                                trackTitleElement.textContent = m;
                            disableAllControls();
                            isPlaying = false;
                            playAfterLoad = false;
                            currentPlayerType = 'none';
                            updatePlayPauseButton(false);
                            container?.classList.remove('is-playing');
                        }
                    }
                    );
                    audio.addEventListener('canplay', () => {
                        if (currentPlayerType === 'url') {
                            console.log("Audio CanPlay");
                            if (!audio.error) {
                                enableMainControls();
                                updatePrevNextButtonStates();
                                if (playAfterLoad) {
                                    playAfterLoad = false;
                                    playAudio();
                                }
                            } else
                                console.error("Audio CanPlay with error state.");
                        }
                    }
                    );
                    audio.addEventListener('loadstart', () => {
                        if (currentPlayerType === 'url')
                            console.log("Audio Load Start...");
                    }
                    );
                    audio.addEventListener('pause', () => {
                        if (currentPlayerType === 'url' && isPlaying) {
                            isPlaying = false;
                            updatePlayPauseButton(false);
                            playAfterLoad = false;
                            container?.classList.remove('is-playing');
                        }
                    }
                    );
                    audio.addEventListener('play', () => {
                        if (currentPlayerType === 'url' && !isPlaying) {
                            isPlaying = true;
                            updatePlayPauseButton(true);
                            container?.classList.add('is-playing');
                        }
                    }
                    );
                    audio.addEventListener('seeking', () => {
                        if (currentPlayerType === 'url')
                            console.log("Audio Seeking...");
                    }
                    );
                    audio.addEventListener('seeked', () => {
                        if (currentPlayerType === 'url')
                            console.log("Audio Seeked.");
                    }
                    );
                }

                function togglePlayPause() {
                    if (!userHasInteracted) {
                        console.warn("Interaction needed for playback.");
                        userHasInteracted = true;
                        // Workaround for potential audio context suspension
                        if (window.AudioContext && audio && audio.context && audio.context.state === 'suspended') {
                            audio.context.resume();
                        }
                    }
                    if (playPauseBtn?.disabled) {
                        if (currentTrackIndex < 0 && playlist.length > 0) {
                            playAfterLoad = true;
                            loadTrack(0);
                        }
                        return;
                    }
                    if (isPlaying)
                        pauseAudio();
                    else {
                        playAfterLoad = true;
                        playAudio();
                    }
                }

                function playAudio() {
                    playAfterLoad = false;
                    if (currentPlayerType === 'youtube') {
                        if (youtubePlayer && youtubePlayerReady && typeof youtubePlayer.playVideo === 'function') {
                            console.log("CMD: YT playVideo()");
                            youtubePlayer.playVideo();
                        } else {
                            console.warn("Cannot Play YT: Not ready.");
                            if (youtubePlayer && !youtubePlayerReady)
                                playAfterLoad = true;
                            else if (!youtubePlayer && currentTrackIndex >= 0) {
                                playAfterLoad = true;
                                loadTrack(currentTrackIndex);
                            } else
                                updatePlayPauseButton(false);
                        }
                    } else if (currentPlayerType === 'url') {
                        if (!audio || !audio.src) {
                            console.error("Cannot Play Audio: No object/src.");
                            if (currentTrackIndex >= 0)
                                loadTrack(currentTrackIndex);
                            updatePlayPauseButton(false);
                            return;
                        }
                        if (audio.readyState < audio.HAVE_METADATA) {
                            console.warn("Audio not ready:", audio.readyState);
                            playAfterLoad = true;
                            audio.load();
                            return;
                        }
                        console.log("CMD: Audio play()");
                        const p = audio.play();
                        if (p !== undefined) {
                            p.then(_ => {}
                            ).catch(e => {
                                console.error(`Audio Play Fail: ${e.name}`, e);
                                isPlaying = false;
                                playAfterLoad = false;
                                updatePlayPauseButton(false);
                                container?.classList.remove('is-playing');
                                if (e.name === 'NotAllowedError') {
                                    if (trackTitleElement && !trackTitleElement.textContent.includes("Click"))
                                        trackTitleElement.textContent += " (Click Play)";
                                    userHasInteracted = false;
                                } else if (e.name === 'NotSupportedError') {
                                    if (trackTitleElement)
                                        trackTitleElement.textContent = "Format Err";
                                    disableAllControls();
                                    currentPlayerType = 'none';
                                } else {
                                    if (trackTitleElement)
                                        trackTitleElement.textContent = `Play Err: ${e.name}`;
                                    disableMainControls();
                                }
                                updatePrevNextButtonStates();
                            }
                            );
                        }
                    } else {
                        console.warn("Cannot Play: No player type.");
                        updatePlayPauseButton(false);
                        if (currentTrackIndex < 0 && playlist.length > 0) {
                            playAfterLoad = true;
                            loadTrack(0);
                        }
                    }
                }

                function pauseAudio() {
                    playAfterLoad = false;
                    if (currentPlayerType === 'youtube') {
                        if (youtubePlayer && youtubePlayerReady && typeof youtubePlayer.pauseVideo === 'function') {
                            console.log("CMD: YT pauseVideo()");
                            youtubePlayer.pauseVideo();
                        } else
                            console.warn("Cannot Pause YT: Not ready.");
                    } else if (currentPlayerType === 'url') {
                        if (audio && !audio.paused) {
                            console.log("CMD: Audio pause()");
                            audio.pause();
                        } else
                            console.warn("Cannot Pause Audio: Not playing.");
                    } else
                        console.warn("Cannot Pause: No player type.");
                }

                function playNextTrack(triggeredByEnd = false) {
                    if (!playlist || playlist.length === 0) return;
                    
                    // Repeat One mode
                    if (repeatMode === 'one' && triggeredByEnd) {
                        seekToStart();
                        if (currentPlayerType === 'youtube' && youtubePlayer) {
                            youtubePlayer.playVideo();
                        } else if (currentPlayerType === 'url' && audio) {
                            audio.play();
                        }
                        return;
                    }
                    
                    // Single track handling
                    if (playlist.length === 1 && !triggeredByEnd) {
                        seekToStart();
                        return;
                    }
                    
                    const shouldContinuePlay = isPlaying || triggeredByEnd;
                    let nextIndex = (currentTrackIndex + 1) % playlist.length;
                    
                    // Stop at end if repeat is off
                    if (repeatMode === 'off' && nextIndex === 0 && triggeredByEnd) {
                        pauseAudio();
                        seekToStart();
                        return;
                    }
                    
                    playAfterLoad = shouldContinuePlay;
                    loadTrack(nextIndex);
                }

                function playPrevTrack() {
                    if (!playlist || playlist.length === 0)
                        return;
                    const shouldContinuePlay = isPlaying;
                    if (shouldContinuePlay && getCurrentPlaybackTime() > 3) {
                        seekToStart();
                        return;
                    }
                    if (playlist.length === 1) {
                        seekToStart();
                        return;
                    }
                    const prevIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
                    playAfterLoad = shouldContinuePlay;
                    loadTrack(prevIndex);
                }

                function getCurrentPlaybackTime() {
                    if (currentPlayerType === 'youtube' && youtubePlayerReady && typeof youtubePlayer.getCurrentTime === 'function')
                        return youtubePlayer.getCurrentTime();
                    else if (currentPlayerType === 'url' && audio && !isNaN(audio.currentTime))
                        return audio.currentTime;
                    return 0;
                }

                function seekToStart() {
                    if (progressBar)
                        progressBar.style.width = '0%';
                    if (currentPlayerType === 'youtube' && youtubePlayerReady && typeof youtubePlayer.seekTo === 'function')
                        youtubePlayer.seekTo(0, true);
                    else if (currentPlayerType === 'url' && audio && audio.readyState >= 1)
                        audio.currentTime = 0;
                    if (!isPlaying && currentPlayerType === 'url') {
                        // N·∫øu ƒëang pause audio, c·∫ßn c·∫≠p nh·∫≠t l·∫°i progress bar sau khi seek
                        requestAnimationFrame( () => {
                            if (progressBar && currentPlayerType === 'url')
                                progressBar.style.width = '0%';
                        }
                        );
                    }
                }

                if (progressContainer) {
                    // Progress bar click handler
                    progressContainer.addEventListener('click', (e) => {
                        if (playPauseBtn?.disabled)
                            return;
                        let duration = 0;
                        let playerAvailable = false;
                        if (currentPlayerType === 'youtube' && youtubePlayerReady && typeof youtubePlayer.getDuration === 'function') {
                            duration = youtubePlayer.getDuration();
                            playerAvailable = duration > 0;
                        } else if (currentPlayerType === 'url' && audio && audio.duration && !isNaN(audio.duration) && audio.readyState >= 1) {
                            duration = audio.duration;
                            playerAvailable = true;
                        }
                        if (!playerAvailable || duration <= 0)
                            return;
                        try {
                            const r = progressContainer.getBoundingClientRect();
                            if (e.clientX < r.left || e.clientX > r.right)
                                return;
                            const c = Math.max(0, Math.min(1, (e.clientX - r.left) / progressContainer.offsetWidth));
                            const t = c * duration;
                            if (progressBar)
                                progressBar.style.width = `${c * 100}%`;
                            if (currentPlayerType === 'youtube')
                                youtubePlayer.seekTo(t, true);
                            else
                                audio.currentTime = t;
                        } catch (err) {
                            console.error("Seek error:", err);
                        }
                    }
                    );
                }

                function enableMainControls() {
                    if (playPauseBtn)
                        playPauseBtn.disabled = false;
                    if (progressContainer)
                        progressContainer.style.cursor = 'pointer';
                    updatePrevNextButtonStates();
                }
                function disableMainControls() {
                    if (playPauseBtn)
                        playPauseBtn.disabled = true;
                    if (progressContainer)
                        progressContainer.style.cursor = 'default';
                }
                function disableAllControls() {
                    disableMainControls();
                    if (prevBtn)
                        prevBtn.disabled = true;
                    if (nextBtn)
                        nextBtn.disabled = true;
                }
                function updatePrevNextButtonStates() {
                    const canGo = playlist && playlist.length > 1;
                    if (prevBtn)
                        prevBtn.disabled = !canGo || playPauseBtn?.disabled;
                    if (nextBtn)
                        nextBtn.disabled = !canGo || playPauseBtn?.disabled;
                }
                function updatePlayPauseButton(playing) {
                    if (playIcon)
                        playIcon.setAttribute('name', playing ? 'pause-outline' : 'play-outline');
                    if (playPauseBtn)
                        playPauseBtn.setAttribute('aria-label', playing ? 'T·∫°m d·ª´ng' : 'Ph√°t');
                }

                // ============================
                // === CLOCK / TODO / ANIME (Logic kh√¥ng ƒë·ªïi, gi·ªØ nguy√™n) ===
                // ============================
                function updateClock() {
                    if (!clockElement)
                        return;
                    try {
                        const n = new Date()
                          , h = String(n.getHours()).padStart(2, '0')
                          , m = String(n.getMinutes()).padStart(2, '0')
                          , s = String(n.getSeconds()).padStart(2, '0');
                        clockElement.textContent = `${h}:${m}:${s}`;
                    } catch (e) {
                        console.error("Clock err:", e);
                        if (clockInterval)
                            clearInterval(clockInterval);
                    }
                }

                // === INFO WIDGET FUNCTIONS ===
                function updateCurrentDate() {
                    try {
                        const now = new Date();
                        const dateStr = now.toLocaleDateString('en-US', { 
                            weekday: 'short', 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric' 
                        });
                        
                        const dateEl = document.getElementById('current-date');
                        if (dateEl) dateEl.textContent = dateStr;
                    } catch (e) {
                        console.error('Date update error:', e);
                    }
                }

                function updateLocationDisplay() {
                    try {
                        const locationEl = document.getElementById('location-text');
                        if (!locationEl) return;
                        
                        // Try geolocation API
                        if ('geolocation' in navigator) {
                            navigator.geolocation.getCurrentPosition(
                                (position) => {
                                    const lat = position.coords.latitude;
                                    const lon = position.coords.longitude;
                                    
                                    // Use reverse geocoding API (OpenStreetMap Nominatim is free)
                                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                                        .then(r => r.json())
                                        .then(data => {
                                            const city = data.address?.city || data.address?.town || data.address?.county || 'Unknown';
                                            const country = data.address?.country || '';
                                            locationEl.textContent = city + (country ? `, ${country}` : '');
                                        })
                                        .catch(err => {
                                            console.error('Geocoding error:', err);
                                            locationEl.textContent = 'Unable to load';
                                        });
                                },
                                (error) => {
                                    console.log('Geolocation error:', error);
                                    locationEl.textContent = 'Location denied';
                                }
                            );
                        } else {
                            locationEl.textContent = 'Not supported';
                        }
                    } catch (e) {
                        console.error('Location update error:', e);
                        const locationEl = document.getElementById('location-text');
                        if (locationEl) locationEl.textContent = 'Error';
                    }
                }

                function updateWeatherDisplay() {
                    try {
                        const weatherEl = document.getElementById('weather-text');
                        if (!weatherEl) return;
                        
                        if ('geolocation' in navigator) {
                            navigator.geolocation.getCurrentPosition(
                                (position) => {
                                    const lat = position.coords.latitude;
                                    const lon = position.coords.longitude;
                                    
                                    // Use Open-Meteo weather API (free, no key required)
                                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,relative_humidity_2m&temperature_unit=celsius`)
                                        .then(r => r.json())
                                        .then(data => {
                                            if (data.current) {
                                                const temp = Math.round(data.current.temperature_2m);
                                                const humidity = data.current.relative_humidity_2m;
                                                weatherEl.textContent = `${temp}¬∞C, ${humidity}%`;
                                            }
                                        })
                                        .catch(err => {
                                            console.error('Weather API error:', err);
                                            weatherEl.textContent = 'Unable to load';
                                        });
                                },
                                (error) => {
                                    console.log('Geolocation error:', error);
                                    weatherEl.textContent = 'Location denied';
                                }
                            );
                        } else {
                            weatherEl.textContent = 'Not supported';
                        }
                    } catch (e) {
                        console.error('Weather update error:', e);
                        const weatherEl = document.getElementById('weather-text');
                        if (weatherEl) weatherEl.textContent = 'Error';
                    }
                }

                function scheduleNotification(t) {
                    if (!t.notifyTime || t.completed || !(t.notifyTime instanceof Date) || isNaN(t.notifyTime))
                        return;
                    const n = Date.now()
                      , s = t.notifyTime.getTime()
                      , d = s - n;
                    if (t.timeoutId) {
                        clearTimeout(t.timeoutId);
                        t.timeoutId = null;
                    }
                    if (d > 0 && notificationPermission === 'granted') {
                        t.timeoutId = setTimeout( () => {
                            showNotification(t);
                            const c = tasks.find(x => x.id === t.id);
                            if (c) {
                                c.timeoutId = null;
                                saveTasks();
                                renderTasks();
                            }
                        }
                        , d);
                    } else
                        t.timeoutId = null;
                }
                function showNotification(t) {
                    if (notificationPermission !== 'granted')
                        return;
                    try {
                        const n = new Notification('üìÖ Vi·ªác c·∫ßn l√†m!',{
                            body: t.text,
                            icon: 'https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg',
                            tag: t.id,
                            renotify: true
                        });
                        n.onclick = () => {
                            window.focus();
                            const l = todoListElement?.querySelector(`li[data-id="${t.id}"]`);
                            if (l) {
                                l.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });
                                l.style.backgroundColor = 'rgba(var(--color-primary-rgb),0.2)';
                                setTimeout( () => {
                                    l.style.backgroundColor = '';
                                }
                                , 1500);
                            }
                        }
                        ;
                        n.onerror = e => console.error('Notif err:', e);
                    } catch (e) {
                        console.error('Show notif err:', e);
                    }
                }
                function renderTask(t) {
                    const l = document.createElement('li');
                    l.dataset.id = t.id;
                    l.className = t.completed ? 'completed' : '';
                    /* l.style.opacity='0'; l.style.transform='translateX(-10px)'; // Managed by intro anim */
                    const c = document.createElement('div');
                    c.className = 'todo-content';
                    const s = document.createElement('span');
                    s.className = 'todo-text';
                    s.textContent = t.text;
                    c.appendChild(s);
                    const d = formatTimeForDisplay(t.notifyTime);
                    if (d) {
                        const i = document.createElement('div');
                        i.className = 'todo-time-info';
                        const n = document.createElement('ion-icon');
                        n.setAttribute('name', 'alarm-outline');
                        n.setAttribute('aria-hidden', 'true');
                        i.appendChild(n);
                        const p = document.createElement('span');
                        const o = new Date()
                          , a = new Date(o);
                        a.setDate(o.getDate() + 1);
                        let f = t.notifyTime?.toDateString() === o.toDateString() ? 'H.nay ' : (t.notifyTime?.toDateString() === a.toDateString() ? 'N.mai ' : '');
                        p.textContent = f + d;
                        p.setAttribute('aria-label', `Nh·∫Øc l√∫c: ${f}${d}`);
                        i.appendChild(p);
                        if (t.notifyTime && t.notifyTime.getTime() < Date.now() && t.timeoutId === null && !t.completed) {
                            const e = document.createElement('ion-icon');
                            e.setAttribute('name', 'checkmark-done-outline');
                            e.setAttribute('aria-hidden', 'true');
                            e.title = 'ƒê√£ qua gi·ªù';
                            i.appendChild(e);
                        }
                        c.appendChild(i);
                    }
                    l.appendChild(c);
                    const o = document.createElement('div');
                    o.className = 'todo-actions';
                    const a = document.createElement('button');
                    a.className = 'complete-btn';
                    const f = t.completed ? 'Ch∆∞a xong' : 'Ho√†n th√†nh';
                    a.setAttribute('aria-label', f);
                    a.title = f;
                    const e = document.createElement('ion-icon');
                    e.setAttribute('name', t.completed ? 'refresh-outline' : 'checkmark-circle-outline');
                    e.setAttribute('aria-hidden', 'true');
                    a.appendChild(e);
                    a.addEventListener('click', () => toggleCompleteTask(t.id));
                    o.appendChild(a);
                    const n = document.createElement('button');
                    n.className = 'delete-btn';
                    n.setAttribute('aria-label', 'X√≥a');
                    n.title = 'X√≥a';
                    const m = document.createElement('ion-icon');
                    m.setAttribute('name', 'trash-outline');
                    m.setAttribute('aria-hidden', 'true');
                    n.appendChild(m);
                    n.addEventListener('click', () => deleteTask(t.id));
                    o.appendChild(n);
                    l.appendChild(o);
                    /* requestAnimationFrame(()=>{l.style.opacity='1';l.style.transform='translateX(0)';}); */
                    return l;
                }
                function renderTasks() {
                    if (!todoListElement)
                        return;
                    tasks.forEach(t => {
                        if (t.timeoutId)
                            clearTimeout(t.timeoutId);
                        t.timeoutId = null;
                    }
                    );
                    const f = document.createDocumentFragment();
                    if (!tasks.length) {
                        const e = document.createElement('li');
                        e.textContent = 'No tasks yet...';
                        e.style.cssText = 'justify-content:center;opacity:0.6;border-left:none;padding:var(--space-sm)';
                        f.appendChild(e);
                    } else {
                        tasks.forEach(t => f.appendChild(renderTask(t)));
                    }
                    todoListElement.innerHTML = '';
                    todoListElement.appendChild(f);
                    tasks.forEach(t => {
                        if (!t.completed && t.notifyTime && t.notifyTime.getTime() > Date.now() && !t.timeoutId)
                            scheduleNotification(t);
                    }
                    );
                    checkNotificationPermission(tasks.some(t => t.notifyTime && !t.completed));
                    /* Animation handled by intro timeline finish event */
                }
                function saveTasks() {
                    if (!window.localStorage)
                        return;
                    try {
                        const s = tasks.map(t => ({
                            ...t,
                            notifyTime: t.notifyTime?.toISOString() || null,
                            timeoutId: null
                        }));
                        localStorage.setItem('niyakiTasks_v2', JSON.stringify(s));
                    } catch (e) {
                        console.error("Save task err:", e);
                        if (e.name === 'QuotaExceededError')
                            alert('LocalStorage full!');
                    }
                }
                function loadTasks() {
                    if (!window.localStorage) {
                        tasks = [];
                        renderTasks();
                        return;
                    }
                    const s = localStorage.getItem('niyakiTasks_v2');
                    if (s) {
                        try {
                            tasks = JSON.parse(s).map(t => ({
                                ...t,
                                notifyTime: t.notifyTime ? new Date(t.notifyTime) : null,
                                timeoutId: null
                            })).filter(t => t.id && t.text);
                        } catch (e) {
                            console.error("Load task err:", e);
                            localStorage.removeItem('niyakiTasks_v2');
                            tasks = [];
                        }
                    } else
                        tasks = [];
                    renderTasks();
                }
                function addTask(e) {
                    e.preventDefault();
                    const t = todoInput.value.trim();
                    const s = todoTimeInput.value;
                    if (!t)
                        return alert('Nh·∫≠p nhi·ªám v·ª•!'),
                        todoInput.focus();
                    let n = null;
                    if (s) {
                        const [h,m] = s.split(':').map(Number);
                        if (!isNaN(h) && !isNaN(m)) {
                            n = new Date();
                            n.setHours(h, m, 0, 0);
                            if (n <= Date.now())
                                n.setDate(n.getDate() + 1);
                        } else
                            return alert('Gi·ªù l·ªói!'),
                            todoTimeInput.focus();
                    }
                    const N = {
                        id: generateId(),
                        text: t,
                        notifyTime: n,
                        completed: false,
                        timeoutId: null
                    };
                    tasks.unshift(N);
                    saveTasks();
                    renderTasks();
                    /* New task added dynamically needs animation if desired */
                    const newTaskEl = todoListElement.querySelector(`li[data-id='${N.id}']`);
                    if (newTaskEl && typeof anime !== 'undefined') {
                        anime({
                            targets: newTaskEl,
                            opacity: [0, 1],
                            translateX: [-10, 0],
                            duration: 300,
                            easing: 'easeOutQuad'
                        });
                    }
                    todoInput.value = '';
                    todoTimeInput.value = '';
                    todoInput.focus();
                }
                function deleteTask(i) {
                    const d = tasks.findIndex(t => t.id === i);
                    if (d > -1) {
                        const task = tasks[d];
                        if (task.timeoutId)
                            clearTimeout(task.timeoutId);
                        const el = todoListElement?.querySelector(`li[data-id="${i}"]`);
                        if (el) {
                            /* Animate before removal */
                            if (typeof anime !== 'undefined') {
                                anime({
                                    targets: el,
                                    opacity: 0,
                                    translateX: 20,
                                    duration: 250,
                                    easing: 'easeInQuad',
                                    complete: () => {
                                        el.remove();
                                        tasks.splice(d, 1);
                                        saveTasks();
                                        if (!tasks.length)
                                            renderTasks();
                                    }
                                });
                            } else {
                                el.remove();
                                tasks.splice(d, 1);
                                saveTasks();
                                renderTasks();
                            }
                        } else {
                            tasks.splice(d, 1);
                            saveTasks();
                            renderTasks();
                        }
                    }
                }
                function toggleCompleteTask(i) {
                    const d = tasks.findIndex(t => t.id === i);
                    if (d > -1) {
                        const t = tasks[d];
                        t.completed = !t.completed;
                        if (t.completed && t.timeoutId) {
                            clearTimeout(t.timeoutId);
                            t.timeoutId = null;
                        } else if (!t.completed && t.notifyTime && t.notifyTime > Date.now() && !t.timeoutId)
                            scheduleNotification(t);
                        saveTasks();
                        renderTasks();
                        const el = todoListElement?.querySelector(`li[data-id="${i}"]`);
                        if (el)
                            el.classList.toggle('completed', t.completed);
                        /* Immediate class toggle is fine */
                    }
                }
                function checkNotificationPermission(s=false) {
                    if (notificationPermission === 'unsupported' || !('Notification'in window)) {
                        if (requestPermissionBtn)
                            requestPermissionBtn.style.display = 'none';
                        return;
                    }
                    notificationPermission = Notification.permission;
                    if (requestPermissionBtn) {
                        if (notificationPermission === 'granted') {
                            requestPermissionBtn.style.display = 'none';
                            tasks.forEach(t => {
                                if (!t.completed && t.notifyTime && t.notifyTime > Date.now() && !t.timeoutId)
                                    scheduleNotification(t);
                            }
                            );
                        } else if (notificationPermission === 'denied')
                            requestPermissionBtn.style.display = 'none';
                        else
                            requestPermissionBtn.style.display = s ? 'inline-flex' : 'none';
                    }
                }
                function handleRequestPermission() {
                    if (notificationPermission === 'unsupported' || !('Notification'in window) || Notification.permission !== 'default') {
                        checkNotificationPermission(false);
                        return;
                    }
                    Notification.requestPermission().then(p => {
                        notificationPermission = p;
                        checkNotificationPermission(false);
                        if (p === 'granted')
                            new Notification('ƒê√£ c·∫•p quy·ªÅn!',{
                                body: 'S·∫Ω c√≥ th√¥ng b√°o.',
                                icon: 'https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg'
                            }),
                            renderTasks();
                        else
                            alert('Kh√¥ng c·∫•p quy·ªÅn.');
                    }
                    ).catch(e => console.error("Perm req err:", e));
                }
                async function loadAnimeData() {
                    console.log("‚è≥ Loading anime data...");
                    if (resultsContainer)
                        resultsContainer.innerHTML = '<p class="placeholder-text">Loading anime data...</p>';
                    if (searchInput) {
                        searchInput.placeholder = "ƒêang t·∫£i...";
                        searchInput.disabled = true;
                    }
                    if (searchButton)
                        searchButton.disabled = true;
                    try {
                        const r = await fetch(ANIME_DATA_URL);
                        if (!r.ok)
                            throw new Error(`HTTP ${r.status}`);
                        const csv = await r.text();
                        allEpisodeRecords = parseCSV_NameEpisodeLink(csv);
                        if (allEpisodeRecords.length > 0) {
                            console.log("‚úÖ Anime data loaded.");
                            if (resultsContainer)
                                resultsContainer.innerHTML = '<p class="placeholder-text">Enter anime name...</p>';
                            if (searchInput) {
                                searchInput.placeholder = "Search for anime...";
                                searchInput.disabled = false;
                            }
                            if (searchButton)
                                searchButton.disabled = false;
                        } else {
                            console.warn("‚ö†Ô∏è No valid records parsed.");
                            if (resultsContainer)
                                resultsContainer.innerHTML = '<p class="placeholder-text error">No data available.</p>';
                            if (searchInput)
                                searchInput.placeholder = "L·ªói data";
                        }
                    } catch (e) {
                        console.error("‚ùå Load/Parse anime error:", e);
                        if (resultsContainer)
                            resultsContainer.innerHTML = `<p class="placeholder-text error">Data loading error.</p>`;
                        if (searchInput) {
                            searchInput.placeholder = "L·ªói t·∫£i";
                            searchInput.disabled = true;
                        }
                        if (searchButton)
                            searchButton.disabled = true;
                    }
                }
                function renderSearchResults(uniqueNames) {
                    if (!resultsContainer)
                        return;
                    resultsContainer.innerHTML = '';
                    if (!uniqueNames.length) {
                        resultsContainer.innerHTML = searchInput?.value.trim() ? '<p class="placeholder-text">Kh√¥ng t√¨m th·∫•y.</p>' : '<p class="placeholder-text">Enter anime name...</p>';
                        return;
                    }
                    const f = document.createDocumentFragment();
                    uniqueNames.forEach(n => {
                        const i = document.createElement('div');
                        i.classList.add('search-result-item');
                        i.textContent = n;
                        i.title = n;
                        i.dataset.animeName = n;
                        i.setAttribute('role', 'button');
                        i.tabIndex = 0;
                        i.addEventListener('click', () => handleAnimeSelect(n));
                        i.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                handleAnimeSelect(n);
                            }
                        }
                        );
                        f.appendChild(i);
                    }
                    );
                    resultsContainer.appendChild(f);
                    resultsContainer.style.display = 'block';
                    if (episodeListContainer)
                        episodeListContainer.style.display = 'none';
                }
                function handleSearch() {
                    if (!searchInput)
                        return;
                    const s = searchInput.value.trim().toLowerCase();
                    if (!allEpisodeRecords.length) {
                        if (resultsContainer && s)
                            resultsContainer.innerHTML = '<p class="placeholder-text error">Data not ready.</p>';
                        else if (resultsContainer)
                            resultsContainer.innerHTML = '<p class="placeholder-text">Enter anime name...</p>';
                        return;
                    }
                    if (!s) {
                        if (resultsContainer)
                            resultsContainer.innerHTML = '<p class="placeholder-text">Enter anime name...</p>';
                        if (episodeListContainer)
                            episodeListContainer.style.display = 'none';
                        return;
                    }
                    const f = allEpisodeRecords.filter(r => r.animeName && r.animeName.toLowerCase().includes(s));
                    const u = [...new Set(f.map(r => r.animeName))];
                    renderSearchResults(u);
                }
                function handleAnimeSelect(name) {
                    console.log(`‚úÖ Selected: "${name}". Finding episodes...`);
                    currentAnimeTitle = name;
                    const episodes = allEpisodeRecords.filter(r => r.animeName === name);
                    console.log(`üéûÔ∏è Found ${episodes.length} episode records.`);
                    renderEpisodeList(episodes);
                    if (resultsContainer)
                        resultsContainer.style.display = 'none';
                    if (episodeListContainer)
                        episodeListContainer.style.display = 'flex';
                    if (episodeListHeading) {
                        episodeListHeading.textContent = currentAnimeTitle;
                        episodeListHeading.style.display = 'block';
                    }
                    if (backToSearchBtn)
                        backToSearchBtn.style.display = 'inline-flex';
                    if (episodeListContainer)
                        episodeListContainer.scrollTop = 0;
                }
                function renderEpisodeList(records) {
                    if (!episodeListUl)
                        return;
                    episodeListUl.innerHTML = '';
                    if (!records || !records.length) {
                        episodeListUl.innerHTML = '<li class="placeholder-text" style="border:none;background:none;text-align:center;width:100%;">Kh√¥ng c√≥ th√¥ng tin t·∫≠p.</li>';
                        return;
                    }
                    const f = document.createDocumentFragment();
                    let validCount = 0;
                    records.forEach(r => {
                        const link = r.link?.trim();
                        const epName = r.episodeName?.trim();
                        const isValidLink = link && link !== '#' && link !== 'URL not found' && link.startsWith('http');
                        if (!epName)
                            return;
                        const i = document.createElement('li');
                        i.classList.add('episode-item');
                        i.textContent = epName;
                        i.title = epName;
                        i.dataset.episodeName = epName;
                        if (isValidLink) {
                            i.dataset.embedLink = link;
                            i.setAttribute('role', 'button');
                            i.tabIndex = 0;
                            i.addEventListener('click', () => handleEpisodePlay(link, epName));
                            i.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter' || e.key === ' ') {
                                    e.preventDefault();
                                    handleEpisodePlay(link, epName);
                                }
                            }
                            );
                        } else {
                            i.style.cssText = 'cursor:not-allowed; opacity:0.6; border-left-color: var(--color-text-secondary);';
                            i.title += ' (Link kh√¥ng kh·∫£ d·ª•ng)';
                        }
                        f.appendChild(i);
                        validCount++;
                    }
                    );
                    if (validCount === 0) {
                        episodeListUl.innerHTML = '<li class="placeholder-text" style="border:none;background:none;text-align:center;width:100%;">Kh√¥ng t√¨m th·∫•y t·∫≠p h·ª£p l·ªá.</li>';
                    } else {
                        episodeListUl.appendChild(f);
                    }
                }
                function handleEpisodePlay(link, epName) {
                    console.log(`‚ñ∂Ô∏è Playing Anime: "${currentAnimeTitle} - ${epName}"`);
                    if (!playerContainer || !playerIframe || !playerTitle || !closePlayerBtn || !link || link === '#') {
                        console.error("Anime Player/Link invalid.");
                        return;
                    }
                    
                    // Clear any existing iframe src to prevent memory leaks
                    playerIframe.src = '';
                    
                    // Create a new iframe element to ensure clean state
                    const newIframe = document.createElement('iframe');
                    newIframe.id = 'anime-iframe';
                    newIframe.title = 'Anime Player';
                    newIframe.frameBorder = '0';
                    newIframe.allowFullscreen = true;
                    newIframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                    
                    // Replace the old iframe with the new one
                    const iframeWrapper = document.querySelector('.iframe-wrapper');
                    iframeWrapper.innerHTML = '';
                    iframeWrapper.appendChild(newIframe);
                    
                    playerTitle.textContent = `${currentAnimeTitle} - ${epName}`;
                    newIframe.src = link;
                    playerContainer.style.display = 'flex';
                    
                    requestAnimationFrame(() => {
                        playerContainer.classList.add('visible');
                        document.body.classList.add('player-open');
                    });
                    
                    closePlayerBtn.focus();
                }
                function closePlayer() {
                    if (!playerContainer || !playerIframe || !playerContainer.classList.contains('visible'))
                        return;
                    playerContainer.classList.remove('visible');
                    document.body.classList.remove('player-open');
                    playerIframe.src = '';
                    const R = () => {
                        if (!playerContainer.classList.contains('visible')) {
                            playerContainer.style.display = '';
                        }
                        playerContainer.removeEventListener('transitionend', R);
                    }
                    ;
                    playerContainer.addEventListener('transitionend', R);
                    setTimeout( () => {
                        if (!playerContainer.classList.contains('visible')) {
                            playerContainer.style.display = '';
                            playerContainer.removeEventListener('transitionend', R);
                        }
                    }
                    , 400);
                }
                function goBackToSearch() {
                    if (resultsContainer)
                        resultsContainer.style.display = 'block';
                    if (episodeListContainer)
                        episodeListContainer.style.display = 'none';
                    if (backToSearchBtn)
                        backToSearchBtn.style.display = 'none';
                    if (searchInput) {
                        searchInput.focus();
                        handleSearch();
                    }
                }


                
                // ============================
                // === INITIALIZATION ===
                // ============================
                console.log("üöÄ Init Profile v13.0 (YouTube Integration)... ‚ú®");
                setPrimaryColorRGB();
                if (clockElement) {
                    updateClock();
                    clockInterval = setInterval(updateClock, 1000);
                }
                
                // Initialize Info Widget (Date, Location, Weather)
                updateCurrentDate();
                updateLocationDisplay();
                updateWeatherDisplay();
                
                loadTasks();
                loadAnimeData();
                loadYouTubeAPI();
                loadLocationAndWeather();
                // Trigger YT API load

                // Init Music Player Listeners
                if (playPauseBtn)
                    playPauseBtn.addEventListener('click', togglePlayPause);
                if (nextBtn)
                    nextBtn.addEventListener('click', () => playNextTrack(false));
                if (prevBtn)
                    prevBtn.addEventListener('click', playPrevTrack);

                
                if (playlist && playlist.length > 0) {
                    if (playPauseBtn)
                        playPauseBtn.disabled = false;
                    // Enable play button
                    updatePrevNextButtonStates();
                    if (trackTitleElement)
                        trackTitleElement.textContent = "Music Player Ready";
                } else {
                    if (trackTitleElement)
                        trackTitleElement.textContent = "Playlist is empty";
                    disableAllControls();
                }
                
                // Init Shuffle & Repeat buttons
                const shuffleBtn = document.getElementById('shuffle-btn');
                const repeatBtn = document.getElementById('repeat-btn');

                if (shuffleBtn) {
                    shuffleBtn.addEventListener('click', toggleShuffle);
                }

                if (repeatBtn) {
                    repeatBtn.addEventListener('click', toggleRepeat);
                }

                // Load saved player state TR∆Ø·ªöC
                loadPlayerState();

                // ‚úÖ AUTO-SHUFFLE ch·ªâ khi L·∫¶N ƒê·∫¶U truy c·∫≠p
                const hasVisited = localStorage.getItem('musicPlayerState');
                if (!hasVisited && playlist && playlist.length > 1) {
                    console.log("üé≤ First visit - Auto shuffling...");
                    
                    // K√≠ch ho·∫°t shuffle (g·ªçi h√†m toggleShuffle 1 l·∫ßn)
                    // V√¨ isShuffleOn ƒëang = false, toggle s·∫Ω b·∫≠t n√≥ l√™n
                    if (!isShuffleOn) {
                        toggleShuffle();
                    }
                    
                    console.log("‚úÖ Auto-shuffle complete!");
                }

                // Load saved player state
                loadPlayerState();

                // Init Other Listeners
                if (searchInput) {
                    searchInput.addEventListener('input', handleSearch);
                    searchInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter')
                            handleSearch();
                    }
                    );
                }
                if (searchButton)
                    searchButton.addEventListener('click', () => {
                        if (searchInput)
                            searchInput.focus();
                        handleSearch();
                    }
                    );
                if (closePlayerBtn)
                    closePlayerBtn.addEventListener('click', closePlayer);
                document.addEventListener('click', (e) => {
                    if (document.body.classList.contains('player-open') && playerContainer && !playerContainer.contains(e.target) && !e.target.closest('.episode-item'))
                        closePlayer();
                }
                );
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && playerContainer?.classList.contains('visible'))
                        closePlayer();
                }
                );
                if (backToSearchBtn)
                    backToSearchBtn.addEventListener('click', goBackToSearch);
                if (todoForm)
                    todoForm.addEventListener('submit', addTask);
                if (requestPermissionBtn)
                    requestPermissionBtn.addEventListener('click', handleRequestPermission);
                
                // Init Tab Listeners
                if (tabsNav) {
                    tabsNav.addEventListener('click', (e) => {
                        if (e.target && e.target.matches('.tab-link')) {
                            const targetId = e.target.dataset.tab;
                            
                            // Update button active state
                            tabsNav.querySelectorAll('.tab-link').forEach(btn => btn.classList.remove('active'));
                            e.target.classList.add('active');

                            // Update content active state
                            tabContents.forEach(content => {
                                content.classList.toggle('active', content.id === targetId);

                                // Initialize Pomodoro when first opened
                                if (content.id === 'pomodoro-content' && content.classList.contains('active') && !content.dataset.loaded) {
                                    content.dataset.loaded = 'true';
                                    if (window.initPomodoroTimer) {
                                        window.initPomodoroTimer();
                                    }
                                }
                            });
                        }
                    });
                }


                // Init Entrance Animations
                try {
                    if (typeof anime !== 'undefined') {
                        const tl = anime.timeline({
                            easing: 'easeOutExpo',
                            duration: 800
                        });
                        tl.add({
                            targets: '#container',
                            opacity: [0, 1],
                            translateY: [20, 0],
                            duration: 600
                        }).add({
                            targets: ['#profile-image-wrapper', '#profile p#username'],
                            opacity: [0, 1],
                            scale: [.8, 1],
                            duration: 600
                        }, '-=450').add({
                            targets: '#clock',
                            opacity: [0, 1],
                            translateY: [10, 0],
                            duration: 400
                        }, '-=450').add({
                            targets: '#location-weather',
                            opacity: [0, 1],
                            translateY: [10, 0],
                            duration: 400
                        }, '-=400').add({
                            targets: '#info-widget-section',
                            opacity: [0, 1],
                            translateY: [10, 0],
                            duration: 400
                        }, '-=400').add({
                            targets: '#todo-section',
                            opacity: [0, 1],
                            translateY: [20, 0],
                            duration: 500
                        }, '-=350')// Todo section appears first
                        .add({
                            targets: '#audio-player',
                            opacity: [0, 1],
                            translateY: [10, 0],
                            duration: 500
                        }, '-=400')// Then audio player
                        .add({
                            targets: '#anime-search-section',
                            opacity: [0, 1],
                            translateY: [20, 0],
                            duration: 500
                        }, '-=400')// Then anime search
                        .add({
                            targets: '#links li',
                            opacity: [0, 1],
                            translateX: [-20, 0],
                            delay: anime.stagger(introStaggerDelay)
                        }, '-=400').add({
                            targets: ['#social-links', 'footer'],
                            opacity: [0, 1],
                            translateY: [20, 0],
                            duration: 500
                        }, '-=400');
                        if (glitchEffectOnLoad && usernameElement)
                            tl.add({
                                targets: usernameElement,
                                duration: 1,
                                begin: () => {
                                    usernameElement.classList.add('glitch-text');
                                    setTimeout( () => {
                                        usernameElement?.classList.remove('glitch-text')
                                    }
                                    , glitchDuration)
                                }
                            }, '-=300');

                        // Animate todo items after todo-section is visible
                        tl.finished.then( () => {
                            if (typeof anime !== 'undefined' && document.querySelectorAll('#todo-list li').length > 0) {
                                anime({
                                    targets: '#todo-list li',
                                    opacity: [0, 1],
                                    translateX: [-10, 0],
                                    delay: anime.stagger(50),
                                    duration: 300,
                                    easing: 'easeOutQuad'
                                });
                            }
                        }
                        );
                    } else {
                        // Fallback if anime.js fails
                        document.querySelectorAll('#container,#profile,#clock,#todo-section,#audio-player,#anime-search-section,#links,#social-links,footer').forEach(el => {
                            el.style.opacity = 1;
                            el.style.transform = 'none';
                        }
                        );
                        renderTasks();
                        // Render todos without animation
                    }
                } catch (e) {
                    // Catch potential errors during animation setup
                    console.error("Anim err:", e);
                    document.querySelectorAll('#container,#profile,#clock,#todo-section,#audio-player,#anime-search-section,#links,#social-links,footer').forEach(el => {
                        el.style.opacity = 1;
                        el.style.transform = 'none';
                    }
                    );
                    renderTasks();
                }

                // Init Hover Animations
                if (avatar) {
                    avatar.addEventListener('mouseenter', () => anime({
                        targets: avatar,
                        scale: 1.08,
                        rotate: 4,
                        duration: 300,
                        easing: 'easeOutBack'
                    }));
                    avatar.addEventListener('mouseleave', () => anime({
                        targets: avatar,
                        scale: 1,
                        rotate: 0,
                        duration: 400,
                        easing: 'easeOutQuad'
                    }));
                }
                Array.from(socialLinksContainer?.querySelectorAll('a') || []).forEach(l => {
                    l.addEventListener('mouseenter', () => anime({
                        targets: l,
                        translateY: -4,
                        scale: 1.15,
                        duration: 250,
                        easing: 'easeOutBack'
                    }));
                    l.addEventListener('mouseleave', () => anime({
                        targets: l,
                        translateY: 0,
                        scale: 1,
                        duration: 350,
                        easing: 'easeOutQuad'
                    }));
                }
                );

                console.log("‚úÖ Initialization v13.0 complete!");
                if (typeof anime !== 'undefined')
                    console.log("‚ÑπÔ∏è Anime.js v:", anime.version);

                // --- FOOTER POSITION LOGIC ---
                function handleFooterPosition() {
                    const container = document.getElementById('container');
                    const leftColumn = document.querySelector('.left-column');
                    const footer = document.querySelector('footer');

                    // Exit if elements aren't found
                    if (!container || !leftColumn || !footer) {
                        console.warn("Footer positioning script couldn't find required elements.");
                        return;
                    }

                    if (window.innerWidth <= 768) {
                        // MOBILE view: Move footer to be a direct child of #container
                        if (footer.parentNode !== container) {
                            container.appendChild(footer);
                        }
                    } else {
                        // DESKTOP view: Move footer back into .left-column
                        if (footer.parentNode !== leftColumn) {
                            leftColumn.appendChild(footer); // Appending puts it at the end, which is correct
                        }
                    }
                }

                // Initial check on load
                handleFooterPosition();
                // Add listener for window resize
                window.addEventListener('resize', handleFooterPosition);


            }
            );
            // --- DOMContentLoaded End ---
        </script>
        <script>
            // --- POMODORO TIMER SCRIPT ---
let pomodoroTimerInterval;
let pomodoroTotalSeconds;
let pomodoroSecondsLeft;
let pomodoroCurrentMode = 'work'; // 'work', 'short-break', 'long-break'
let pomodoroCount = 0; // Pomodoros in current cycle (resets after 4)
let pomodoroIsPaused = true;
let pomodoroNotificationPermission = 'Notification' in window ? Notification.permission : 'unsupported';
let pomodoroDailyPomodoros = 0;
let pomodoroToday = new Date().toDateString();
// The pomodoroInitialized flag is now managed by content.dataset.loaded in index.html

const pomodoroSounds = {
    end: new Audio('https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/timer.mp3'), // Placeholder sound
    //click: new Audio('https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/timer.mp3') // Placeholder sound
};

const POMODORO_DEFAULT_TIMES = {
    work: 25 * 60,
    'short-break': 5 * 60,
    'long-break': 15 * 60
};

const POMODORO_MODE_COLORS = {
    work: {
        color: '#dc3545',
        rgb: '220,53,69'
    }, // Red
    'short-break': {
        color: '#28a745',
        rgb: '40,167,69'
    }, // Green
    'long-break': {
        color: '#007bff',
        rgb: '0,123,255'
    } // Blue
};

// --- Helper Functions ---
function pomodoroFormatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes < 10 ? '0' : ''}${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
}

function updatePomodoroDisplay() {
    const timerDisplay = document.getElementById('timer-display');
    const pomodoroSection = document.getElementById('pomodoro-section');
    const timerModeElement = pomodoroSection?.querySelector('.timer-mode');
    const pomodoroProgressBar = document.getElementById('pomodoro-progress-bar');
    const pomodoroCountElement = document.getElementById('pomodoro-count');

    if (timerDisplay) timerDisplay.textContent = pomodoroFormatTime(pomodoroSecondsLeft);
    if (pomodoroProgressBar) {
        const percentage = (pomodoroSecondsLeft / pomodoroTotalSeconds) * 100;
        pomodoroProgressBar.style.width = `${percentage}%`;
    }
    if (pomodoroCountElement) pomodoroCountElement.textContent = `Pomodoros: ${pomodoroCount % 4}/${4} (${pomodoroDailyPomodoros} today)`;
    
    if (timerModeElement) {
        timerModeElement.textContent = pomodoroCurrentMode.replace('-', ' ').toUpperCase();
        pomodoroSection?.querySelector('.pomodoro-display')?.classList.remove('work', 'short-break', 'long-break');
        pomodoroSection?.querySelector('.pomodoro-display')?.classList.add(pomodoroCurrentMode);
    }
}

function pomodoroPlaySound(type = 'end') {
    const soundVolumeInput = document.getElementById('sound-volume');
    if (pomodoroSounds[type]) {
        pomodoroSounds[type].volume = parseFloat(soundVolumeInput?.value || '0.8');
        pomodoroSounds[type].currentTime = 0; // Rewind to start
        pomodoroSounds[type].play().catch(e => console.warn("Pomodoro sound playback failed:", e));
    }
}

function pomodoroShowNotification(title, body) {
    if (pomodoroNotificationPermission === 'granted') {
        new Notification(title, {
            body: body,
            icon: 'https://raw.githubusercontent.com/htch9999/htch.github.io/refs/heads/main/assets/htch.jpg'
        });
    }
}

function updatePomodoroDocumentTitle() {
    document.title = `${pomodoroFormatTime(pomodoroSecondsLeft)} - ${pomodoroCurrentMode.toUpperCase()} | Pomodoro`;
}

function setPomodoroColors() {
    document.documentElement.style.setProperty('--pomodoro-work-color', POMODORO_MODE_COLORS.work.color);
    document.documentElement.style.setProperty('--pomodoro-work-color-rgb', POMODORO_MODE_COLORS.work.rgb);
    document.documentElement.style.setProperty('--pomodoro-short-break-color', POMODORO_MODE_COLORS['short-break'].color);
    document.documentElement.style.setProperty('--pomodoro-short-break-color-rgb', POMODORO_MODE_COLORS['short-break'].rgb);
    document.documentElement.style.setProperty('--pomodoro-long-break-color', POMODORO_MODE_COLORS['long-break'].color);
    document.documentElement.style.setProperty('--pomodoro-long-break-color-rgb', POMODORO_MODE_COLORS['long-break'].rgb);
}

// --- Timer Logic ---
function startPomodoroTimer() {
    const startPauseBtn = document.getElementById('start-pause-btn');
    const skipBtn = document.getElementById('skip-btn');
    const autoStartBreaksCheckbox = document.getElementById('auto-start-breaks');
    const autoStartPomodorosCheckbox = document.getElementById('auto-start-pomodoros');

    if (!pomodoroIsPaused) return;

    pomodoroIsPaused = false;
    if (startPauseBtn) {
        startPauseBtn.innerHTML = '<ion-icon name="pause-outline"></ion-icon> Pause';
        startPauseBtn.setAttribute('aria-label', 'Pause Pomodoro');
    }
    if (skipBtn) skipBtn.style.display = 'inline-flex';

    pomodoroTimerInterval = setInterval(() => {
        pomodoroSecondsLeft--;
        updatePomodoroDisplay();
        updatePomodoroDocumentTitle();

        if (pomodoroSecondsLeft <= 0) {
            clearInterval(pomodoroTimerInterval);
            pomodoroPlaySound('end');
            pomodoroShowNotification('Pomodoro Timer', `Time for ${pomodoroCurrentMode === 'work' ? 'a break!' : 'work!'}`);
            handlePomodoroTimerEnd();
        }
    }, 1000);
}

function pausePomodoroTimer() {
    const startPauseBtn = document.getElementById('start-pause-btn');
    const skipBtn = document.getElementById('skip-btn');

    pomodoroIsPaused = true;
    clearInterval(pomodoroTimerInterval);
    if (startPauseBtn) {
        startPauseBtn.innerHTML = '<ion-icon name="play-outline"></ion-icon> Start';
        startPauseBtn.setAttribute('aria-label', 'Start Pomodoro');
    }
    if (skipBtn) skipBtn.style.display = 'none';
    updatePomodoroDocumentTitle();
}

function resetPomodoroTimer() {
    pausePomodoroTimer();
    pomodoroCount = 0;
    pomodoroSecondsLeft = getPomodoroUserDuration('work');
    pomodoroTotalSeconds = pomodoroSecondsLeft;
    pomodoroCurrentMode = 'work';
    updatePomodoroDisplay();
    updatePomodoroDocumentTitle();
    document.title = 'Loif Chan | Profile'; // Reset to original title
    const skipBtn = document.getElementById('skip-btn');
    if (skipBtn) skipBtn.style.display = 'none';
    savePomodoroState();
}

function handlePomodoroTimerEnd() {
    const autoStartBreaksCheckbox = document.getElementById('auto-start-breaks');
    const autoStartPomodorosCheckbox = document.getElementById('auto-start-pomodoros');

    if (pomodoroCurrentMode === 'work') {
        pomodoroCount++;
        pomodoroDailyPomodoros++;
        if (pomodoroCount % 4 === 0) {
            pomodoroCurrentMode = 'long-break';
            pomodoroSecondsLeft = getPomodoroUserDuration('long-break');
        } else {
            pomodoroCurrentMode = 'short-break';
            pomodoroSecondsLeft = getPomodoroUserDuration('short-break');
        }
    } else {
        pomodoroCurrentMode = 'work';
        pomodoroSecondsLeft = getPomodoroUserDuration('work');
    }
    pomodoroTotalSeconds = pomodoroSecondsLeft;
    updatePomodoroDisplay();
    savePomodoroState();

    if ((pomodoroCurrentMode === 'work' && autoStartPomodorosCheckbox?.checked) ||
        ((pomodoroCurrentMode === 'short-break' || pomodoroCurrentMode === 'long-break') && autoStartBreaksCheckbox?.checked)) {
        startPomodoroTimer();
    } else {
        pausePomodoroTimer();
    }
}

function skipPomodoroCurrentMode() {
    pomodoroPlaySound('click'); // Play sound first
    
    if (!pomodoroIsPaused) {
        clearInterval(pomodoroTimerInterval);
    }
    
    // Always allow skip, whether paused or not
    handlePomodoroTimerEnd();
}

// --- Settings and UI ---
function getPomodoroUserDuration(mode) {
    const workDurationInput = document.getElementById('work-duration');
    const shortBreakDurationInput = document.getElementById('short-break-duration');
    const longBreakDurationInput = document.getElementById('long-break-duration');
    let duration;
    switch (mode) {
        case 'work':
            duration = parseInt(workDurationInput?.value) || 25;
            break;
        case 'short-break':
            duration = parseInt(shortBreakDurationInput?.value) || 5;
            break;
        case 'long-break':
            duration = parseInt(longBreakDurationInput?.value) || 15;
            break;
        default:
            duration = 25;
    }
    return duration * 60;
}

function updatePomodoroSettings() {
    // Apply new durations only if timer is paused
    if (pomodoroIsPaused) {
        if (pomodoroCurrentMode === 'work') {
            pomodoroSecondsLeft = getPomodoroUserDuration('work');
        } else if (pomodoroCurrentMode === 'short-break') {
            pomodoroSecondsLeft = getPomodoroUserDuration('short-break');
        } else if (pomodoroCurrentMode === 'long-break') {
            pomodoroSecondsLeft = getPomodoroUserDuration('long-break');
        }
        pomodoroTotalSeconds = pomodoroSecondsLeft;
        updatePomodoroDisplay();
    }
    savePomodoroState();
}

function togglePomodoroDarkMode() {
    document.body.classList.toggle('light-mode');
    savePomodoroState();
}

function setPomodoroVolume() {
    const soundVolumeInput = document.getElementById('sound-volume');
    const volume = parseFloat(soundVolumeInput?.value || '0.8');
    for (const key in pomodoroSounds) {
        if (pomodoroSounds.hasOwnProperty(key)) {
            pomodoroSounds[key].volume = volume;
        }
    }
    savePomodoroState();
}

// --- State Management (localStorage) ---
function savePomodoroState() {
    const workDurationInput = document.getElementById('work-duration');
    const shortBreakDurationInput = document.getElementById('short-break-duration');
    const longBreakDurationInput = document.getElementById('long-break-duration');
    const autoStartBreaksCheckbox = document.getElementById('auto-start-breaks');
    const autoStartPomodorosCheckbox = document.getElementById('auto-start-pomodoros');
    const soundVolumeInput = document.getElementById('sound-volume');

    if (!window.localStorage) return;
    const state = {
        secondsLeft: pomodoroSecondsLeft,
        currentMode: pomodoroCurrentMode,
        pomodoroCount: pomodoroCount,
        isPaused: pomodoroIsPaused,
        workDuration: workDurationInput?.value,
        shortBreakDuration: shortBreakDurationInput?.value,
        longBreakDuration: longBreakDurationInput?.value,
        autoStartBreaks: autoStartBreaksCheckbox?.checked,
        autoStartPomodoros: autoStartPomodorosCheckbox?.checked,
        soundVolume: soundVolumeInput?.value,
        isLightMode: document.body.classList.contains('light-mode'),
        dailyPomodoros: pomodoroDailyPomodoros,
        lastDay: pomodoroToday
    };
    localStorage.setItem('pomodoroState', JSON.stringify(state));
}

function loadPomodoroState() {
    const workDurationInput = document.getElementById('work-duration');
    const shortBreakDurationInput = document.getElementById('short-break-duration');
    const longBreakDurationInput = document.getElementById('long-break-duration');
    const autoStartBreaksCheckbox = document.getElementById('auto-start-breaks');
    const autoStartPomodorosCheckbox = document.getElementById('auto-start-pomodoros');
    const soundVolumeInput = document.getElementById('sound-volume');

    if (!window.localStorage) return;
    const savedState = localStorage.getItem('pomodoroState');
    if (savedState) {
        const state = JSON.parse(savedState);
        pomodoroSecondsLeft = state.secondsLeft;
        pomodoroCurrentMode = state.currentMode;
        pomodoroCount = state.pomodoroCount;
        pomodoroIsPaused = state.isPaused;
        
        if (workDurationInput) workDurationInput.value = state.workDuration || '25';
        if (shortBreakDurationInput) shortBreakDurationInput.value = state.shortBreakDuration || '5';
        if (longBreakDurationInput) longBreakDurationInput.value = state.longBreakDuration || '15';
        if (autoStartBreaksCheckbox) autoStartBreaksCheckbox.checked = state.autoStartBreaks || false;
        if (autoStartPomodorosCheckbox) autoStartPomodorosCheckbox.checked = state.autoStartPomodoros || false;
        if (soundVolumeInput) soundVolumeInput.value = state.soundVolume !== undefined ? state.soundVolume : '0.8';
        
        if (state.isLightMode) {
            document.body.classList.add('light-mode');
        } else {
            document.body.classList.remove('light-mode');
        }

        if (state.lastDay !== pomodoroToday) {
            pomodoroDailyPomodoros = 0;
            pomodoroToday = new Date().toDateString();
        } else {
            pomodoroDailyPomodoros = state.dailyPomodoros;
        }
        
        pomodoroTotalSeconds = getPomodoroUserDuration(pomodoroCurrentMode);
        
        if (pomodoroSecondsLeft > pomodoroTotalSeconds) {
            pomodoroSecondsLeft = pomodoroTotalSeconds;
        }

        if (!pomodoroIsPaused && (
            (pomodoroCurrentMode === 'work' && autoStartPomodorosCheckbox?.checked) || 
            ((pomodoroCurrentMode === 'short-break' || pomodoroCurrentMode === 'long-break') && autoStartBreaksCheckbox?.checked)
        )) {
            startPomodoroTimer();
        } else {
            pausePomodoroTimer();
        }
    } else {
        resetPomodoroTimer();
    }
    setPomodoroVolume();
    updatePomodoroDisplay();
}

function pomodoroRequestNotificationPermission() {
    if (!('Notification' in window)) {
        pomodoroNotificationPermission = 'unsupported';
        console.warn("Notifications not supported in this browser.");
        return;
    }
    if (Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
            pomodoroNotificationPermission = permission;
            if (permission === 'denied') {
                console.warn("Notification permission denied.");
            }
        });
    } else {
        pomodoroNotificationPermission = Notification.permission;
    }
}

// --- Main Initialization Function ---
function initPomodoroTimer() {
    // The initialization is now controlled by index.html using content.dataset.loaded
    console.log("Initializing Pomodoro Timer...");

    const startPauseBtn = document.getElementById('start-pause-btn');
    const resetBtn = document.getElementById('reset-btn');
    const skipBtn = document.getElementById('skip-btn');
    const workDurationInput = document.getElementById('work-duration');
    const shortBreakDurationInput = document.getElementById('short-break-duration');
    const longBreakDurationInput = document.getElementById('long-break-duration');
    const autoStartBreaksCheckbox = document.getElementById('auto-start-breaks');
    const autoStartPomodorosCheckbox = document.getElementById('auto-start-pomodoros');
    const soundVolumeInput = document.getElementById('sound-volume');
    const toggleDarkModeBtn = document.getElementById('toggle-dark-mode-btn');

    setPomodoroColors();
    loadPomodoroState();
    pomodoroRequestNotificationPermission();
    // Settings collapse toggle
    const settingsToggle = document.getElementById('settings-toggle');
    const settingsContent = document.querySelector('.pomodoro-settings-content');
    const toggleIcon = settingsToggle?.querySelector('.settings-toggle-icon');
    
    if (settingsToggle && settingsContent) {
        settingsToggle.addEventListener('click', () => {
            settingsContent.classList.toggle('collapsed');
            toggleIcon?.classList.toggle('collapsed');
            
            // Save collapse state
            const isCollapsed = settingsContent.classList.contains('collapsed');
            localStorage.setItem('pomodoroSettingsCollapsed', isCollapsed);
        });
        
        // Restore collapse state
        const savedCollapsed = localStorage.getItem('pomodoroSettingsCollapsed');
        if (savedCollapsed === 'true') {
            settingsContent.classList.add('collapsed');
            toggleIcon?.classList.add('collapsed');
        }
    }

    if (startPauseBtn) startPauseBtn.addEventListener('click', () => {
        pomodoroPlaySound('click');
        if (pomodoroIsPaused) {
            startPomodoroTimer();
        } else {
            pausePomodoroTimer();
        }
    });

    if (resetBtn) resetBtn.addEventListener('click', () => {
        pomodoroPlaySound('click');
        resetPomodoroTimer();
    });

    if (skipBtn) skipBtn.addEventListener('click', () => {
        pomodoroPlaySound('click');
        skipPomodoroCurrentMode();
    });

    workDurationInput?.addEventListener('change', updatePomodoroSettings);
    shortBreakDurationInput?.addEventListener('change', updatePomodoroSettings);
    longBreakDurationInput?.addEventListener('change', updatePomodoroSettings);
    autoStartBreaksCheckbox?.addEventListener('change', savePomodoroState);
    autoStartPomodorosCheckbox?.addEventListener('change', savePomodoroState);
    soundVolumeInput?.addEventListener('input', setPomodoroVolume);
    toggleDarkModeBtn?.addEventListener('click', togglePomodoroDarkMode);
    
    // Save state before unload
    window.addEventListener('beforeunload', savePomodoroState);

    // Reset daily pomodoro count at midnight
    setInterval(() => {
        const newDay = new Date().toDateString();
        if (newDay !== pomodoroToday) {
            pomodoroToday = newDay;
            pomodoroDailyPomodoros = 0;
            savePomodoroState();
        }
    }, 1000 * 60 * 60); // Check every hour
}

// Expose the init function globally for index.html to call
window.initPomodoroTimer = initPomodoroTimer;

        </script>
    </body>
</html>
